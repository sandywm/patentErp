<!DOCTYPE html>
<html>
<head>
 	<meta charset="utf-8"/>
 	<link href="/plugins/layui/css/layui.css" rel="stylesheet" type="text/css"/>
 	<link href="/plugins/pace/pace-theme-flash.min.css" rel="stylesheet" type="text/css"/>
 	<link href="/Module/zlBasicInfoManager/css/zlBasicInfoManager.css" rel="stylesheet" type="text/css"/>
	<script src="/plugins/pace/pace.min.js" type="text/javascript"></script>
  	<title>增加新专利</title>
</head>
<body style="background:#fff;">
	<div id="addNewZl" class="layui-form">
		<div class="layui-form-item">
			<label class="layui-form-label"><span>*</span>案件标题</label>
			<div class="layui-input-block">
				<input id="ajTitleInp" type="text" name="ajTitle" placeholder="请输入案件标题(40字以内)" maxlength="40" autocomplete="off" class="layui-input"/>
			</div>				
		</div>
		<div class="layui-form-item clearfix">
			<div class="itemDiv">
				<label class="layui-form-label">案件编号</label>
				<div class="layui-input-inline">
					<input id="ajNumInp" type="text" disabled autocomplete="off" class="layui-input"/>
				</div>	
			</div>			
			<div class="itemDiv">
				<label class="layui-form-label">案件申请号/专利号</label>
				<div class="layui-input-inline">
					<input id="ajSqZlNum" type="text" name="ajSqZlNum" disabled autocomplete="off" class="layui-input"/>
				</div>	
			</div>			
		</div>
		<div class="layui-form-item clearfix">
			<div class="itemDiv">
				<label class="layui-form-label"><span>*</span>专利类型</label>
				<input id="zlTypeInp" name="ajType" type="hidden" value=""/>
				<div class="layui-input-inline">
					<input type="radio" name="zlTypeRad" class="zlTypeRad" lay-filter="zlTypeFilter" value="fm" title="发明"/>
					<input type="radio" name="zlTypeRad" class="zlTypeRad" lay-filter="zlTypeFilter" value="syxx" title="实用新型"/>
					<input type="radio" name="zlTypeRad" class="zlTypeRad" lay-filter="zlTypeFilter" value="wg" title="外观"/>
					<input type="radio" name="zlTypeRad" class="zlTypeRad" lay-filter="zlTypeFilter" value="fmxx" title="发明+新型"/>
				</div>	
			</div>	
			<div class="itemDiv">
				<label class="layui-form-label">已领取专利任务</label>
				<div class="layui-input-inline">
					<input id="pubZlIdInp" type="hidden" name="pubZlId"/>					
					<input id="pubZlIdInpTxt" type="text" disabled autocomplete="off" class="layui-input" style="width:94%"/>
					<span class="selZlTaskSp" title="选择"><i class="layui-icon layui-icon-more"></i></span>
					<span class="resetSp" title="重置"><i class="layui-icon layui-icon-delete"></i></span>
				</div>	
			</div>			
		</div>
		<div class="layui-form-item">
			<label class="layui-form-label"><span>*</span>案件技术领域</label>
			<div class="layui-input-block fixHeiDiv clearfix">
				<input id="ajFieldId" type="hidden" name="ajFieldId"/>
				<div id="fieldBox" class="multiBox fl"></div>
				<span id="addFieldBtn" class="addSpan fl">添加技术领域</span>
			</div>
		</div>
		<div class="layui-form-item">
			<label class="layui-form-label"><span>*</span>案件申请地区</label>
			<input id="ajSqAddress" type="hidden" name="ajSqAddress"/>
			<div class="layui-input-block fixHeiDiv clearfix">
				<input type="radio" name="ajSqRad" lay-filter="ajSqAreaFilter" value="中国" title="中国[CN]"/>
				<input type="radio" name="ajSqRad" lay-filter="ajSqAreaFilter" value="中国香港" title="中国香港[HK]"/>
				<input type="radio" name="ajSqRad" lay-filter="ajSqAreaFilter" value="中国台湾" title="中国台湾[TW]"/>
				<input type="radio" name="ajSqRad" lay-filter="ajSqAreaFilter" value="澳门" title="澳门[MO]"/>
				<input type="radio" name="ajSqRad" lay-filter="ajSqAreaFilter" value="日本" title="日本[JP]"/>
			</div>
		</div>
		<div class="layui-form-item">
			<label class="layui-form-label"><span>*</span>申请人</label>
			<input id="sqrIdInp" type="hidden"/>
			<div class="layui-input-block fixHeiDiv clearfix">
				<input id="ajSqrId" type="hidden" name="ajSqrId"/>
				<div id="sqrBox" class="multiBox fl"></div>
				<span id="addSqrBtn" class="addSpan fl">添加/编辑申请人</span>
			</div>
		</div>
		<div class="layui-form-item">
			<label class="layui-form-label">联系人</label>
			<div class="layui-input-block fixHeiDiv clearfix">
				<input id="ajLxrId" type="hidden" name="ajLxrId"/>
				<div class="multiBox fl" style="width:100%;">
					<div id="lxrBox" class="multiBox fl"></div>
					<span id="addlxrBtn" opts="addLxrOpts" class="addSpan fl">添加/编辑联系人</span>
				</div>
			</div>
		</div>
		<div class="layui-form-item">
			<label class="layui-form-label">发明人</label>
			<div class="layui-input-block fixHeiDiv clearfix">
				<input id="ajFmrId" type="hidden" name="ajFmrId"/>
				<div class="multiBox fl" style="width:100%;">
					<div id="fmrBox" class="multiBox fl"></div>
					<span id="addFmrBtn" opts="addFmrOpts" class="addSpan fl">添加/编辑发明人</span>
				</div>
			</div>
		</div>
		<div class="layui-form-item">
			<label class="layui-form-label">优先权</label>
			<div class="blockDiv fixHeiDiv clearfix">
				<input id="yxqDetailInp" type="hidden" name="yxqDetail"/>
				<div id="yxqBox">
					<div id="innerYxqBox"></div>
					<span id="addYxqBtn" class="addSpan margLAddSp fl">添加优先权</span>
				</div>
			</div>
		</div>
		<div class="layui-form-item">
			<label class="layui-form-label">案件额外要求</label>
			<input id="ajEwyqId" type="hidden" name="ajEwyqId"/>
			<input id="tmpAjEwyqId" type="hidden"/>
			<div id="ewyqBpx" class="layui-input-block"></div>
		</div>
		<div class="layui-form-item">
			<label class="layui-form-label">案件备注</label>
			<div class="layui-input-block">
				<textarea id="ajRemark" name="ajRemark" placeholder="请输入案件备注(80字以内)" class="layui-textarea" maxlength="80"></textarea>
			</div>
		</div>
		<div class="layui-form-item">
			<label class="layui-form-label"><span>*</span>定稿提交截止时间</label>
			<div class="layui-input-inline">
				<input type="text" class="layui-input" id="cpyDateInp" name="cpyDate"/>
			</div>
			<div class="layui-form-mid layui-word-aux">(系统默认一个月)</div>
		</div>
		<div class="layui-form-item">
			<label class="layui-form-label">案件附件</label>
			<div class="layui-input-block">
				<button type="button" class="layui-btn layui-btn-normal" id="selFileBtn">选择文件</button> 
				<span class="noticeSpan">注：附件中单个图片大小不能超过5M，单个文件大小不能超过10M (非必填项)</span>
				<button type="button" class="layui-btn" id="upListAction">上传附件</button>
			</div>
		</div>
		<div class="layui-form-item">
			<input id="fujianInp" name="zlUpCl" type="hidden"/>
			<div class="layui-input-block">
				<table class="layui-table">
			      <thead>
			        <tr><th>附件名</th>
			        <th>大小</th>
			        <th>状态</th>
			        <th>操作</th>
			      </tr></thead>
			      <tbody id="upLoadFileList"></tbody>
			    </table>
			</div>
		</div>
		<div class="layui-form-item">
			<label class="layui-form-label"></label>
			<div class="layui-input-block" style="width:75%;text-align:center;">
				<button type="button" id="saveZlBtn" class="layui-btn" style="width:120px;margin-left:0px;">保存专利</button>
			</div>
		</div>
	</div>
	<script src="/plugins/jquery/jquery-1.7.2.min.js"></script>
	<script src="/plugins/layui/layui.js"></script>
	<script src="/plugins/frame/js/upLoadFiles.js"></script>
	<script type="text/javascript">
		var delFlag = "${ requestScope.delFlag }",
			upFlag = "${ requestScope.upFlag }",
			addFlag = "${ requestScope.addFlag }";
		var num=0,tmpEwyqIdArray=[],upSuccSrcArray = [],addEditZlOpts = parent.addEditZlOpts,isHasLxrFlag = false,isHasFmrFlag = false,fieldArray=[],sqrArray=[],sqrIdArray=[],sqrTxtArray=[],lxrIdArray=[],lxrIdNum=[],fmrIdNum=[],fmrIdArray=[],addCustFlag=false,addEditLxrOpts='',addEditFmrOpts='',tmpLxrFmrOpts='',isZlAddFmLxFlag=true;
		layui.use(['layer','form','laydate'],function(){
			var layer = layui.layer,
				//$ = layui.jquery,
				form = layui.form,
				laydate = layui.laydate;
			var page = {
				init : function(){
					this.onLoad();
					this.bindEvent();
				},
				onLoad : function(){
					if(addEditZlOpts == 'editZlOpts'){//表示编辑
						
					}else{//表示增加 onload直接调用上传这个方法
						selectFileUpload();
						this.getCpyDate();
						//this.getEwYqList(yqType);
					}
				},
				bindEvent : function(){
					var _this = this;
					//选择已领取未添加的专利
					$('.selZlTaskSp').on('click',function(){
						parent.zlTypeInp = $('#zlTypeInp').val();
						parent.addZlFlag = false;
						parent.layer.open({
							title:'添加已领取未添加专利任务',
							type: 2,
						  	area: ['850px', '510px'],
						  	fixed: true, //不固定
						  	maxmin: false,
						  	shadeClose :false,
						  	content: '/Module/zlBasicInfoManager/jsp/addHasLqZl.html',
						  	end:function(){
						  		if(parent.addZlFlag){
									$('#pubZlIdInp').val(parent.$('#lqZlIdInp').val());
									$('#pubZlIdInpTxt').val(parent.$('#lqZlIdInpText').val());
									$('#zlTypeInp').val(parent.$('#lqZlTypeInp').val());
									$('.zlTypeRad').each(function(i){
										if($('.zlTypeRad').eq(i).val() == parent.$('#lqZlTypeInp').val()){
											$('.zlTypeRad').eq(i).attr('checked',true);
										}
									});	
									form.render();	
									_this.getAjNum(parent.$('#lqZlTypeInp').val());		
									_this.getEwYqList(parent.$('#lqZlTypeInp').val());		
									tmpEwyqIdArray.length = 0;		
						  		}
						  	}
						});	
					});
					//重置已选择的专利领取任务
					$('.resetSp').on('click',function(){
						if(parent.addZlFlag){
							layer.confirm('确认要清空当前已选择的领取任务？', {
							  title:'提示',
							  skin: 'layui-layer-molv',
							  btn: ['确定','取消'] //按钮
							},function(index){
								$('#pubZlIdInp').val('');
								parent.$('#lqZlIdInp').val('');
								$('#pubZlIdInpTxt').val('');
								parent.$('#lqZlIdInpText').val('');
								$('#zlTypeInp').val('');
								$('.zlTypeRad').each(function(i){
									$('.zlTypeRad').eq(i).attr('checked',false);
								});	
								$('#ajNumInp').val('');
								form.render();
								layer.close(index);
								parent.addZlFlag = false;
							});
						}
					});
					//添加技术领域
					$('#addFieldBtn').on('click',function(){
						layer.open({
							title:'添加专业领域',
							type: 2,
						  	area: ['500px', '320px'],
						  	fixed: true, //不固定
						  	maxmin: false,
						  	shadeClose :false,
						  	content: '/Module/zlBasicInfoManager/jsp/addZyField.html'
						});	
					});
					//添加申请人
					$('#addSqrBtn').on('click',function(){
						layer.open({
							title:'添加申请人',
							type: 2,
						  	area: ['720px', '350px'],
						  	fixed: true, //不固定
						  	maxmin: false,
						  	shadeClose :false,
						  	content: '/Module/zlBasicInfoManager/jsp/addSqr.html'
						});	
					});
					//添加联系人
					$('#addlxrBtn').on('click',function(){
						_this.commonLayerLxrFmr('添加联系人','addLxrOption');
						addEditLxrOpts = tmpLxrFmrOpts = $(this).attr('opts');
						if($('#lxrBox p').length > 0 && isHasLxrFlag){
							//表示已经创建了联系人，假如删除了某个申请人，此时应该从新匹配lxrIdArray lxrIdNum
							lxrIdArray.length = 0;
							lxrIdNum.length = 0;
							$('#lxrBox p').each(function(i){
								lxrIdArray.push($('#lxrBox p').eq(i).attr('id'));
								lxrIdNum.push($('#lxrBox p').eq(i).attr('id').split('_')[1]);
							});
						}
					});
					//添加发明人
					$('#addFmrBtn').on('click',function(){
						addCustFlag = false;
						_this.commonLayerLxrFmr('添加发明人','addFmrOption');
						addEditFmrOpts = tmpLxrFmrOpts = $(this).attr('opts');
						if($('#fmrBox p').length > 0 && isHasFmrFlag){
							//表示已经创建了发明人，假如删除了某个申请人，此时应该从新匹配fmrIdArray fmrIdNum
							fmrIdArray.length = 0;
							fmrIdNum.length = 0;
							$('#fmrBox p').each(function(i){
								fmrIdArray.push($('#fmrBox p').eq(i).attr('id'));
								fmrIdNum.push($('#fmrBox p').eq(i).attr('id').split('_')[1]);
							});
						}
					});
					//添加优先权
					$('#addYxqBtn').on('click',function(){
						var strHtml = '';
						num ++;
						if($('.innerYxqBox').length > 4){
							layer.msg('抱歉，最多可以添加5个优先权', {icon:5,anim:6,time:1000});
							return;
						}
						strHtml += '<div class="innerYxqBox">';
						strHtml += '<input placeholder="请输入案件申请号/专利号" type="text" autocomplete="off" class="layui-input zlAjNumInp"/>';
						strHtml += '<div class="innerSelAddBox"><select class="zlYxqAreaInp" lay-filter="ajsqAreaSel">';
						strHtml += '<option value="">请选择申请地区</option>';
						strHtml += '<option value="中国">中国[CN]</option>';
						strHtml += '<option value="中国香港">中国香港[HK]</option>';
						strHtml += '<option value="中国台湾">中国台湾[TW]</option>';
						strHtml += '<option value="澳门">澳门[MO]</option>';
						strHtml += '<option value="日本">日本[JP]</option></select></div>';
						strHtml += '<input placeholder="请选择日期" type="text" name="" autocomplete="off" id="dateInp_'+ num +'" hasSelFlag="false" class="layui-input yxqInpDate"/>';
						strHtml += '<i class="layui-icon layui-icon-delete delYxqIcon"  title="删除"></i>';
						strHtml += '</div>';
						$('#innerYxqBox').append(strHtml);
						form.render();
						laydate.render({
							elem:'#dateInp_' + num
						});
						_this.delYxq();				
					});
					//保存增加的专利
					$('#saveZlBtn').on('click',function(){
						alert(addFlag)
						var ajTitleVal = $.trim($('#ajTitleInp').val()),//案件标题
							//ajNumInpVal = $('#ajNumInp').val(),//案件编号
							zlTypeInpVal = $('#zlTypeInp').val(),//专利类型
							ajFieldIdVal = $('#ajFieldId').val(),//案件技术领域
							ajSqAddressVal = $('#ajSqAddress').val(),//案件申请地区
							ajSqrIdVal = $('#ajSqrId').val(),//案件申请人
							ajLxrIdVal = $('#ajLxrId').val(),//案件联系人
							ajFmrIdVal = $('#ajFmrId').val(),//案件发明人
							yxqDetailInpVal = $('#yxqDetailInp').val(),//案件优先权
							//fujianInpVal = $('#fujianInp').val(),//案件附件
							ajEwyqIdVal = $('#ajEwyqId').val(),//案件额外要求
							ajRemarkVal = $('#ajRemark').val(),//案件备注
							cpyDateInpVal = $('#cpyDateInp').val(),//定稿提交截至时间
							pubZlIdInpVal = $('#pubZlIdInp').val(),//已领取专利任务
							url = '';
							
						ajFieldIdVal = _this.getIdStr('delFieldBtn','jffieldattrid');
						ajSqrIdVal = _this.getIdStr('delSqrBtn','sqrattrid');
						ajLxrIdVal = _this.getIdStr('delLxrBtn','lxridattr');
						ajFmrIdVal = _this.getIdStr('delFmrBtn','fmridattr');
						if(tmpEwyqIdArray.length != 0){
							$('#tmpAjEwyqId').val(tmpEwyqIdArray.join(','));
							ajEwyqIdVal = $('#tmpAjEwyqId').val();
						}else{
							$('#tmpAjEwyqId').val(0);
						}
						if(ajTitleVal == ''){
							layer.msg('案件标题不能为空', {icon:5,anim:6,time:1000});
						}else if(zlTypeInpVal == ''){
							layer.msg('请选择专利类型', {icon:5,anim:6,time:1000});
						}else if(ajFieldIdVal == ''){
							layer.msg('请选择案件所属技术领域', {icon:5,anim:6,time:1000});
						}else if(ajSqAddressVal == ''){
							layer.msg('请选择案件申请地区', {icon:5,anim:6,time:1000});
						}else if(ajSqrIdVal == ''){
							layer.msg('请添加申请人', {icon:5,anim:6,time:1000});
						}else{
							//alert(ajFieldIdVal + "----" + ajSqrIdVal + "--" + ajLxrIdVal + "--" + ajFmrIdVal)
							if($('.innerYxqBox').length > 0){
								var strResult = _this.getYxqId();
								if(strResult != undefined){
									yxqDetailInpVal = strResult;
								}else{
									//表明现在还有已经增加好但是没有填写完整的表单
									return;
								}
							}else{
								yxqDetailInpVal = '';
							}
							$('#tmpAjEwyqId').val() == '' ? ajEwyqIdVal = 0 : ajEwyqIdVal = $('#tmpAjEwyqId').val();
							var isHasUpLoadFlag = false;
							if($('.deleteBtn').length > 0){
								if($('input[name="hasUpSuccInp"]').length == 0){//表示用户选择了文件，但是没有点击上传
									isHasUpLoadFlag = false;
								}else if($('input[name="hasUpSuccInp"]').length > 0 && $('input[name="notUpInp"]').length == 0){
									//表示用户选择了文件并且全部上传了
									isHasUpLoadFlag = true;
								}else if($('input[name="hasUpSuccInp"]').length > 0 && $('input[name="notUpInp"]').length > 0){
									//表示用户选择了文件并且上传了，然后用户又选择了文件但是并没有上传
									isHasUpLoadFlag = false;
								}
								if(isHasUpLoadFlag){
									upSuccSrcArray.length = 0;
									$('input[name="hasUpSuccInp"]').each(function(i){
										upSuccSrcArray.push($('input[name="hasUpSuccInp"]').eq(i).val());
									});
									$('#fujianInp').val(upSuccSrcArray.join(','));
								}else{
									layer.msg('您有未上传的附件，请先上传附件',{icon:5,anim:6,time:1000});
									return;
								}
							}
							if(addEditZlOpts == 'editZlOpts'){
							
							}else{
								//表示增加专利
								var field = {ajTitle:escape(ajTitleVal),
												ajType:zlTypeInpVal,ajFieldId:ajFieldIdVal,ajSqAddress:ajSqAddressVal,
												ajSqrId:ajSqrIdVal,ajLxrId:ajLxrIdVal,ajFmrId:ajFmrIdVal,
												yxqDetail:yxqDetailInpVal,ajEwyqId:ajEwyqIdVal,ajRemark:ajRemarkVal,
												ajUpload:$('#fujianInp').val(),cpyDate:cpyDateInpVal,pubZlId:pubZlIdInpVal},
									url = '/zlm.do?action=addZlData';
								//console.log(ajTitleVal + "--" +zlTypeInpVal + "-" + ajFieldIdVal + "-" + ajSqAddressVal + "--" + ajSqrIdVal + "-" + ajLxrIdVal+"-"+ajFmrIdVal+"-"+yxqDetailInpVal+"-"+ajEwyqIdVal+"-"+ajRemarkVal+"-"+$('#fujianInp').val()+"-"+cpyDateInpVal+"-"+pubZlIdInpVal)	
								layer.load('1');
								$.ajax({
				   					type:'post',
				   			        async:false,
				   			        dataType:'json',
				   			        data:field,
				   			        url:url,
				   			        success:function (json){
				   			        	layer.closeAll('loading');
				   			        	console.log(json)
				   			        	if(json['result'] == 'success'){
				   			        		function callBackSucc(){
				   			        			var index= parent.layer.getFrameIndex(window.name);
						        				parent.addZlFlag = true;
						        				parent.layer.close(index);
				   			        		}
				   			        		if(addEditZlOpts == 'editZlOpts'){
				   			        			layer.msg('编辑专利成功',{icon:1,time:1000},callBackSucc);
				   			        		}else{
				   			        			layer.msg('添加专利成功',{icon:1,time:1000},callBackSucc);
				   			        		}
				   			        	}else if(json['result'] == 'noAbility'){
				   			        		layer.msg('抱歉，您暂无权限添加编辑专利', {icon:5,anim:6,time:1000});
				   			        	}else if(json['result'] == 'error'){
				   			        		layer.msg('系统错误，请稍后重试', {icon:5,anim:6,time:1000});
				   			        	}
				   			        }
				   				});
			   				}
							
						}
					});
				},
				//获取优先权
				getYxqId : function(){
					var _this = this,totalRes='';
					var totalFlag=false,tmpZlAjNumFlag=true, tmpZlYxqAreaFlag = true,tmpZlYxqDateFlag=true,zlAjNum = '',totalZlAjNum='',zlYxqArea = '',totalZlYxqArea='',zlYxqDate = '',totalZlYxqDate='';
					$('.zlAjNumInp').each(function(i){
						if($('.zlAjNumInp').eq(i).val() == ''){
							tmpZlAjNumFlag = false;
						}
						if($('.zlAjNumInp').length == 1){
							zlAjNum = $('.zlAjNumInp').eq(i).val();
							totalZlAjNum = zlAjNum;
						}else{
							zlAjNum += $('.zlAjNumInp').eq(i).val() + ',';
							totalZlAjNum = zlAjNum.substring(0,zlAjNum.length-1);
						}
					});
					$('.zlYxqAreaInp').each(function(i){
						if($('.zlYxqAreaInp').eq(i).val() == ''){
							tmpZlYxqAreaFlag = false;
						}
						if($('.zlYxqAreaInp').length == 1){
							zlYxqArea = $('.zlYxqAreaInp').eq(i).val();
							totalZlYxqArea = zlYxqArea;
						}else{
							zlYxqArea += $('.zlYxqAreaInp').eq(i).val() + ',';
							totalZlYxqArea = zlYxqArea.substring(0,zlYxqArea.length-1);
						}
					});
					$('.yxqInpDate').each(function(i){
						if($('.yxqInpDate').eq(i).val() == ''){
							tmpZlYxqDateFlag = false;
						}
						if($('.yxqInpDate').length == 1){
							zlYxqDate = $('.yxqInpDate').eq(i).val();
							totalZlYxqDate = zlYxqDate;
						}else{
							zlYxqDate += $('.yxqInpDate').eq(i).val() + ',';
							totalZlYxqDate = zlYxqDate.substring(0,zlYxqDate.length-1);
						}
					});
					if(!tmpZlAjNumFlag){
						layer.msg('请输入案件申请号/专利号', {icon:5,anim:6,time:1000});
						return;
					}else if(!tmpZlYxqAreaFlag){
						layer.msg('请选择申请地区', {icon:5,anim:6,time:1000});
						return;
					}else if(!tmpZlYxqDateFlag){
						layer.msg('请选择申请时间', {icon:5,anim:6,time:1000});
						return;
					}
					if(tmpZlAjNumFlag &&  tmpZlYxqAreaFlag && tmpZlYxqDateFlag){
						totalFlag = true;
					}	
					if(totalFlag){				
						totalRes = totalZlAjNum + ':' + totalZlYxqArea + ':' + totalZlYxqDate;
						return totalRes;
					}
						
				},
				//获取案件技术领域/案件申请人、联系人、发明人的公共方法
				getIdStr : function(obj,attrName){
					var tmpIdArray=[],strId = '';
					$('.'+obj).each(function(i){
						tmpIdArray.push($('.'+obj).eq(i).attr(attrName));
					});
					strId = tmpIdArray.join(',');
					return strId;
				},
				//删除添加的优先权
				delYxq : function(){
					$('.delYxqIcon').on('click',function(){
						$(this).parent().remove();
						return false;
					});
				},
				//发明人联系公共弹窗
				commonLayerLxrFmr : function(title,opts){
					var _this = this;
					if(sqrArray.length == 0){
						layer.msg('请先添加申请人', {icon:5,anim:6,time:1000});
						return;
					}
					layer.open({
						title:title,
						type: 2,
					  	area: ['720px', '380px'],
					  	fixed: true, //不固定
					  	maxmin: false,
					  	shadeClose :false,
					  	content: '/Module/zlBasicInfoManager/jsp/addLxr.html'
					});	
				},
				//获取定稿提交截至时间
				getCpyDate : function(){
					var date1 = new Date();
					var date2 = new Date(date1);
					date2.setDate(date1.getDate()+30);
					var defaultVal = date2.getFullYear() + "-" + (date2.getMonth()+1) + "-" + date2.getDate();
					laydate.render({
						elem: '#cpyDateInp',
						value : defaultVal
					});
				},
				//获取案件额外要求记录
				getEwYqList : function(yqType){
					var _this = this;
					$.ajax({
	   					type:'post',
	   			        async:false,
	   			        dataType:'json',
	   			        data:{yqType : yqType},
	   			        url:'/zlyq.do?action=getZlyqData',
	   			        success:function (json){
	   			        	layer.closeAll('loading');
	   			        	var yqInfo = json.yqInfo;
	   			        	if(json['result'] == 'success'){
	   			        		_this.renderZlYq(yqInfo);
	   			        	}else if(json['result'] == 'noAbility'){
	   			        		$('#ewyqBpx').html('<p class="noYqData"><i class="layui-icon layui-icon-face-cry"></i>抱歉，您暂无权限获取专利额外要求列表</p>');
	   			        	}else if(json['result'] == 'noInfo'){
	   			        		$('#ewyqBpx').html('<p class="noYqData"><i class="layui-icon layui-icon-face-cry"></i>暂无此专利类型的案件专利额外要求，如若需要，请联系超级管理员进行添加</p>');
	   			        	}
	   			        }
	   				});
				},
				//获取案件编号
				getAjNum : function(yqType){
					layer.load('1');
					$.ajax({
	   					type:'post',
	   			        async:false,
	   			        dataType:'json',
	   			        data:{ajType : yqType},
	   			        url:'/zlm.do?action=getCurrAjNo',
	   			        success:function (json){
	   			        	layer.closeAll('loading');
	   			        	if(json['result'] == 'success'){
	   			        		$('#ajNumInp').val(json['currNextAjNo']);
	   			        	}else if(json['result'] == 'error'){
	   			        		layer.msg('系统错误，请稍后重试', {icon:5,anim:6,time:1000});
	   			        	}
	   			        }
	   				});
				},
				//更加选择的专利类型加载对应的专利额外要求
				renderZlYq : function(yqInfo){
					var strHtml = '';
					for(var i=0;i<yqInfo.length;i++){
						strHtml += '<input type="checkbox" name="zlYqInfoInp" lay-filter="ewyqFilter" value="'+ yqInfo[i].id +'" title="'+ yqInfo[i].yqContent +'" lay-skin="primary"/>';
					}
					$('#ewyqBpx').html(strHtml);
					form.render();
				}
			};
			//专利类型form radio监听事件
			form.on('radio(zlTypeFilter)', function(data){
				var value = data.value;
				$('#zlTypeInp').val(value);
				tmpEwyqIdArray.length = 0;
				if(value == 'fmxx'){
					$('.selZlTaskSp').hide();
					$('#pubZlIdInp').val('');
					$('#pubZlIdInpTxt').val('');
					parent.addZlFlag = false;
				}else{
					$('.selZlTaskSp').show();
				}
				if(parent.addZlFlag){
					$('#pubZlIdInp').val('');
					parent.$('#lqZlIdInp').val('');
					$('#pubZlIdInpTxt').val('');
					parent.$('#lqZlIdInpText').val('');
				}
				page.getAjNum(value);
				page.getEwYqList(value);
			});
			//案件申请地区form radio监听
			form.on('radio(ajSqAreaFilter)', function(data){
				var value = data.value;
				$('#ajSqAddress').val(value);
			});
			//案件额外要求
			form.on('checkbox(ewyqFilter)',function(data){
				var value = data.value;
				if(data.elem.checked){
					tmpEwyqIdArray.push(value);
				}else{
					for(var i=0;i<tmpEwyqIdArray.length;i++){
						if(value == tmpEwyqIdArray[i]){
							tmpEwyqIdArray.splice(i,1);
						}
					}
				}
			});
			function selectFileUpload(){
				var upLoadFileList = $('#upLoadFileList'),url = '';
				if(addEditZlOpts == 'editZlOpts'){//编辑已增加的专利
					url = '/upload.do?action=uploadFile&ajId=' + zlId;
				}else{//增加专利
					console.log("nihao")
					url = '/upload.do?action=uploadFile&ajId=0&fileType=dg';
				}
				$('#selFileBtn').upfile(url);
				if(addEditZlOpts == 'editZlOpts' && $('.deleteBtn_edit').length > 0){//表示编辑的时候执行附件删除动作
					$('.deleteBtn_edit').on('click',function(){
						$(this).parent().parent().remove();
						if($('.deleteBtn_edit').length == 0){
							$('#fujianInp').val('');
						}
					});
				}
				$('.downloadBtn').on('click',function(){
					var downFilePath = $(this).attr('downFilePath');
					window.location.href = "/zlm.do?action=downFile&fileUrl=" + downFilePath;
				});
			}
			$(function(){
				page.init();				
			});
		});
		//公共删除已添加的方法（技术领域、申请人）
		function delHasAddMethod(obj,opts){
			var tmpArray = [];
			$('.'+ obj).on('click',function(){
				var objId = $(this).attr('id'),lxrLen = $('#lxrBox p').length,fmrLen = $('#fmrBox p').length;
				var objSqrId = '';
				if(opts == 'delFieldOpt'){
					tmpArray = fieldArray;
				}else if(opts == 'delSqrOpt'){
					tmpArray = sqrArray;
					objSqrId = $(this).attr('id').split('_')[1];
				}else if(opts == 'delLxrOpt'){
					tmpArray = lxrIdArray;
				}else if(opts == 'delFmrOpt'){
					tmpArray = fmrIdArray;
				}
				for(var i=0;i<tmpArray.length;i++){
					if(objId == tmpArray[i]){
						tmpArray.splice(i,1);
						if(opts == 'delSqrOpt'){
							sqrIdArray.splice(i,1);
							sqrTxtArray.splice(i,1);
						}
					}
				}
				$(this).remove();
				if(opts == 'delSqrOpt'){
					if(lxrLen > 0){
						isHasLxrFlag = true;
						$('input[name=myParSqr_'+ objSqrId +']').parent().remove();
						//删除后还应该检测下当前下是否还存在lxr 假如不存在 应该将数组清空
						if($('#lxrBox p').length == 0){
							lxrIdArray.length = 0;
							lxrIdNum.length = 0;
						}
					}else{
						isHasLxrFlag = false;
					}
					if(fmrLen > 0){
						isHasFmrFlag = true;
						$('input[name=myParSqr_'+ objSqrId +']').parent().remove();
						if($('#fmrBox p').length == 0){
							fmrIdArray.length = 0;
							fmrIdNum.length = 0;
						}
					}else{
						isHasFmrFlag = false;
					}
				}
			});
		}
	</script>
</body> 
</html>