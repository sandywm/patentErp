<!DOCTYPE html>
<html>
<head>
 	<meta charset="utf-8"/>
 	<link href="/plugins/layui/css/layui.css" rel="stylesheet" type="text/css"/>
 	<link href="/plugins/pace/pace-theme-flash.min.css" rel="stylesheet" type="text/css"/>
 	<link href="/Module/zlBasicInfoManager/css/zlBasicInfoManager.css" rel="stylesheet" type="text/css"/>
 	<link href="/Module/zlBasicInfoManager/css/lcfp.css" rel="stylesheet" type="text/css"/>
 	<link href="/Module/zlBasicInfoManager/css/lcDetail.css" rel="stylesheet" type="text/css"/>
	<script src="/plugins/pace/pace.min.js" type="text/javascript"></script>
  	<title>专利详情</title>
</head>
<body class="zlDetaiBody" style="background:#fff;">
	<!-- 基本信息 流程负责人员 流程 通知书 附件 费用 -->
	<div id="layuiTab" class="layui-tab" lay-filter="zlDetailFilter">
		<div class="zlDetailTab  layui-tab-brief">
			<ul class="layui-tab-title">
				<li class="layui-this">基本信息</li>
				<li>流程负责人员</li>
				<li>流程</li>
				<li>通知书</li>
				<li>附件</li>
				<li>费用</li>
			</ul>
			<a class="closeBtns" href="javascript:void(0)" opts="closeGlobal"><i class="layui-icon layui-icon-close"></i></a>
		</div>
		<div class="layui-tab-content" style="padding:10px 0;">
			<!-- 基本信息 -->
			<div id="addNewZl" class="layui-form layui-tab-item layui-show"></div>
			<!-- 流程分配人员 -->
			<div id="addLcFp" class="layui-form layui-tab-item"></div>
			<!-- 流程 -->
			<div id="viewLcDetail" class="layui-tab-item">
				<ul class="lcDetailTit">
					<li class="oneWid">流程名称</li>
					<li class="twoWid">开始时间</li>
					<li class="twoWid">管制期限</li>
					<li class="twoWid">官方绝限</li>
					<li class="twoWid">完成时间</li>
					<li class="threeWid">操作</li>
				</ul>
				<div id="lcDetailCon"></div>
				<div id="lxMxDetailCon">
					<div id="mxTit"></div>
					<ul class="mxDetailTit">
						<li>子节点名称</li>
						<li>流程负责人</li>
						<li>开始时间</li>
						<li>完成时间</li>
					</ul>
					<div id="mxDetailCon"></div>
				</div>
			</div>
			<!-- 通知书 -->
			<div id="tzsDetail" class="layui-tab-item">
				<ul class="tzsTit">
					<li>通知书名称</li>
					<li>通知书发文日</li>
					<li>官方绝限日</li>
					<li>下载</li>
				</ul>
				<ul id="tzsCon"></ul>
			</div>
			<!-- 附件 -->
			<div id="fujianDetail" class="layui-tab-item">
				<ul class="fjTit">
					<li class="oneFjWid">附件名称</li>
					<li class="twoFjWid">附件类型</li>
					<!--  li class="twoFjWid">附件版本</li-->
					<li class="twoFjWid">附件格式</li>
					<li class="twoFjWid">附件大小</li>
					<li class="twoFjWid">上传者</li>
					<li class="threeFjWid">上传日期</li>
					<li class="fourFjWid">操作<li>
				</ul>
				<ul id="fjCon"></ul>
			</div>
			<!-- 费用明细 -->
			<div id="feeDetail" class="layui-tab-item" style="padding:0 10px;">
				<!-- 搜索部分  -->
				<div class="searchPart layui-form">
					<!-- 根据费用类型 缴费状态 是否代缴 退换状态  -->
					<div class="itemDivs fl">
						<div class="layui-input-inline">
							<input id="feeTypeInp" type="hidden" value=""/>
							 <select id="feeType" lay-filter="feeType">
							 	<option value="">请选择费用类型(全部)</option>
							 	<option value="gf">官费</option>
							 	<option value="dlf">代理费</option>
							 	<option value="nf">年费</option>
							 	<option value="jlj">奖励金</option>
							 </select> 
						</div>
					</div>
					<div class="itemDivs fl">
						<div class="layui-input-inline">
							<input id="feeStatusInp" type="hidden" value="-1"/>
							 <select id="feeStatusSel" lay-filter="feeStatusSel">
							 	<option value="">请选择缴费状态(全部)</option>
							 	<option value="0">未交</option>
							 	<option value="1">已交</option>
							 </select> 
						</div>
					</div>
					<div class="itemDivs fl">
						<div class="layui-input-inline">
							<input id="isDjStatusInp" type="hidden" value="-1"/>
							 <select id="isDjStatusSel" lay-filter="isDjStatusSel">
							 	<option value="">是否代缴(全部)</option>
							 	<option value="0">自缴</option>
							 	<option value="1">代缴</option>
							 </select> 
						</div>
					</div>
					<div id="isBackStatusBox" class="itemDivs fl">
						<div class="layui-input-inline">
							<input id="isBackStatusInp" type="hidden" value="-1"/>
							 <select id="isBackStatusSel" lay-filter="isBackStatusSel">
							 	<option value="">请选择退换状态(全部)</option>
							 	<option value="0">未完成</option>
							 	<option value="1">已完成</option>
							 </select> 
						</div>
					</div>
					<div class="itemDivs fl">
  						<div class="layui-input-inline">
  							<button id="queryBtn" class="layui-btn"><i class="layui-icon layui-icon-search
"></i></button>
  						</div>
  					</div>
  					<a class="daochuExcelBtn" href="javascript:void(0)"><i class="iconfont layui-extend-daochuexcel"></i>导出excel</a>
				</div>
				<div id="noData"></div>
				<table id="feeListTable" lay-filter="feeListTable" class="layui-table"></table>
				<!-- 汇总  -->
				<div class="totalInfo"></div>
			</div>
		</div>
	</div>
	<script src="/plugins/jquery/jquery.min.js"></script>
	<script src="/Module/zlBasicInfoManager/js/delMethod.js"></script>
	<script src="/plugins/layui/layui.js"></script>
	<script type="text/javascript">
		var num=0,tmpEwyqIdArray=[],globalFeeId=0,zlId=0,upSuccSrcArray = [],addEditZlOpts = parent.addEditZlOpts,isHasLxrFlag = false,isHasFmrFlag = false,isHasJsLxrFlag=false,fieldArray=[],sqrArray=[],sqrIdArray=[],sqrTxtArray=[],lxrIdArray=[],lxrIdNum=[],fmrIdNum=[],fmrIdArray=[],jsLxrIdNum=[],jsLxrIdArray=[],addCustFlag=false,tmpLxrFmrOpts='',isZlAddFmLxFlag=true;
		layui.config({
			base: '/plugins/frame/js/'
		}).extend({ //设定组件别名
		    common: 'common',// 表示模块文件的名字
		    commonScrollBar: 'scrollBar',// 表示模块文件的名字
		    globalUpload: 'upLoadFiles'
		}).use(['layer','form','laydate','table','element','common','upLoadFiles','scrollBar','rate'],function(){
			var layer = layui.layer,
				form = layui.form,
				element = layui.element,
				laydate = layui.laydate,
				common = layui.common,
				table = layui.table,
				commonScrollBar = layui.scrollBar,
				rate = layui.rate,
				globalUpload = layui.upLoadFiles;
			//tab点击事件的监听
  			element.on('tab(zlDetailFilter)', function(data){
  				if(data.index == 1){
  					//查看/编辑流程负责人员
  					page.commonLoadZlInfo('lcfz','');
  				}else if(data.index == 2){
  					//流程
  					page.commonLoadZlInfo('lc','');
  					$('#lxMxDetailCon').removeClass('animation animationClose');
  					page.data.actGetMxFlag = false;
  				}else if(data.index == 3){
  					//通知书
  					page.commonLoadZlInfo('tzs','');
  				}else if(data.index == 4){//附件
  					page.commonLoadZlInfo('fj','');
  				}else if(data.index == 5){
  					page.commonLoadZlInfo('fy','initLoad');
  					$('#queryBtn').on('click',function(){
						page.commonLoadZlInfo('fy','queryLoad');
					});
  				}
  				$('.closeBtns').attr('opts','closeGlobal');//重置关闭按钮自定义属性至可以关闭整个弹层
 			});
 			//查询form 监听 费用类型
 			form.on('select(feeType)', function(data){
				var value = data.value;
				value == '' ? $('#feeTypeInp').val('') : $('#feeTypeInp').val(value);
			});
			//缴费状态
			form.on('select(feeStatusSel)', function(data){
				var value = data.value;
				value == '' ? $('#feeStatusInp').val(-1) : $('#feeStatusInp').val(value);
			});
			//是否代缴
			form.on('select(isDjStatusSel)', function(data){
				var value = data.value;
				value == '' ? $('#isDjStatusInp').val(-1) : $('#isDjStatusInp').val(value);
				if(value == 1){//代缴 显示退换状态
					$('#isBackStatusBox').show();
				}else{
					$('#isBackStatusBox').hide();
				}
			});
			//是否退换  当时代缴情况下显示 其他隐藏
			form.on('select(isBackStatusSel)', function(data){
				var value = data.value;
				value == '' ? $('#isBackStatusInp').val(-1) : $('#isBackStatusInp').val(value);
			});
			var page = {
				data : {
					upZlFlag : false,
					fpZlFlag : false,
					actGetMxFlag : false,
					isHasFujianFlag : false,
					ajStatus : 0,
					nowLcStr : '<i class="iconfont layui-extend-jinhangzhong ingTaskIcon"></i><span class="ingTaskSp">任务正在进行中<span class="dotting"></span></span>',
					otherLcStr : '<i class="iconfont layui-extend-jinhangzhong"></i><span>任务等待中<span class="dotting"></span></span>',
					hasCompLcStr : '<i class="layui-icon layui-icon-ok statusIcon_com"></i><span class="hasComSp">任务已完成</span>',
					applyTransStr : '<span class="transTips"><i class="layui-icon layui-icon-tips"></i>任务移交申请等待审核中<span class="dotting"></span></span>'
				},
				init : function(){
					this.onLoad();
					this.bindEvent();
				},
				onLoad : function(){
					this.data.upZlFlag = common.getPermission('upZl','',0);
					this.data.fpZlFlag = common.getPermission('fpZl','',0);
					if(addEditZlOpts == 'editZlOpts'){//表示编辑
						this.commonLoadZlInfo('basic',''); //获取基本信息
					}
				},
				//获取专利信息公共方法
				commonLoadZlInfo : function(opts,loadType){
					var _this = this,noData='<div class="noData" style="display:block;"><i class="iconfont layui-extend-noData"></i><p>暂无记录<p></div>';
					layer.load('1');
					if(opts == 'fy'){
						if(loadType == 'initLoad'){
							var field = {zlId : parent.globalZlId,opt:opts,feeTypeStatus:'',djStatus:-1,feeStatus:-1,backStatus:-1};
						}else{//查询	
							var feeTypeStatus = $('#feeTypeInp').val(),
								feeStatus = $('#feeStatusInp').val(),
								djStatus = $('#isDjStatusInp').val(),
								backStatus = $('#isBackStatusInp').val();
							var field = {zlId : parent.globalZlId,opt:opts,feeTypeStatus:feeTypeStatus,djStatus:djStatus,feeStatus:feeStatus,backStatus:backStatus};
						}
					}else{
						var field = {zlId : parent.globalZlId,opt:opts};
					}
					$.ajax({
  						type:'post',
				        async:false,
				        dataType:'json',
				        data : field,
				        url:'/zlm.do?action=getZlDetail',
				        success:function (json){
				        	layer.closeAll('loading');
				        	//console.log(json)
				        	if(json['result'] == 'success'){
				        		if(opts == 'basic'){//获取基本信息
				        			zlId = json.ajId;
		   			        		_this.renderZlBasicInfo(json);
				        		}else if(opts == 'lcfz'){//获取流程分配人员
				        			_this.data.ajStatus = parseFloat(json.ajStatus);
				        			_this.renderLcFpPeo(json);
				        		}else if(opts == 'lc'){//获取流程详情
				        			_this.loadLcDetail(json);
				        		}else if(opts == 'tzs'){//获取通知书
				        			_this.renderTzsDetail(json);
				        		}else if(opts == 'fj'){
				        			_this.renderFjDetail(json);
				        		}else if(opts == 'fy'){
				        			$('#noData').hide().html('');
				        			$('.layui-table-view').show();
				        			var feeInfo = json.feeInfo;
				        			_this.renderFyDetail(feeInfo);
				        			$('.totalInfo').show().html('<p>根据系统结算，当前的专利费用总计为<span>'+ json.feeTotal +'元</span>，代缴费用总计为<span>'+ json.djFeeTotal +'元</span>，优惠费用总计为<span>'+ json.discountsFeeTotal +'元</span>，退换费用总计为<span>'+ json.backFeeTotal +'元</span>，未退费用总计为<span>'+ json.diffFeeTotal +'元</span></p>');
				        		}
				        	}else if(json['result'] == 'noInfo'){
				        		if(opts == 'basic'){
				        			$('#addNewZl').html(noData);
				        		}else if(opts == 'lcfz'){
				        			$('#addLcFp').html(noData);
				        		}else if(opts == 'lc'){
				        			$('#lcDetailCon').html(noData);
				        		}else if(opts == 'tzs'){
				        			$('#tzsCon').html(noData);
				        		}else if(opts == 'fj'){
				        			$('#fjCon').html(noData);
				        		}else if(opts == 'fy'){
				        			$('.layui-table-view').hide();
				        			$('#noData').show().html(noData);
				        			$('.totalInfo').hide().html('');
				        		}
				        	}else if(json['result'] == 'error'){
				        		layer.msg('系统错误，请稍后重试', {icon:5,anim:6,time:1500});
				        	}else if(json['result'] == 'noAbility'){
		   			        	layer.msg('抱歉，您暂无权限', {icon:5,anim:6,time:1500});
		   			        }
				        }
  					});
				},
				bindEvent : function(){
					var _this = this;
					//关闭当前弹窗
					$('.closeBtns').on('click',function(){
						var index= parent.layer.getFrameIndex(window.name),opts = $(this).attr('opts');
						if(opts == 'closeGlobal'){//表示关闭整个弹层
							parent.layer.close(index);
						}else{
							$('#lxMxDetailCon').addClass('animationClose').removeClass('animation');
							$('.closeBtns').attr('opts','closeGlobal');
							_this.data.actGetMxFlag = false;
						}
					});
					//选择已领取未添加的专利
					$('.selZlTaskSp').on('click',function(){
						parent.zlTypeInp = $('#zlTypeInp').val();
						parent.addZlFlag = false;
						parent.layer.open({
							title:'添加已领取未添加专利任务',
							type: 2,
						  	area: ['850px', '510px'],
						  	fixed: true, //不固定
						  	maxmin: false,
						  	shadeClose :false,
						  	content: '/Module/zlBasicInfoManager/jsp/addHasLqZl.html',
						  	end:function(){
						  		if(parent.addZlFlag){
									$('#pubZlIdInp').val(parent.$('#lqZlIdInp').val());
									$('#pubZlIdInpTxt').val(parent.$('#lqZlIdInpText').val());
									$('#zlTypeInp').val(parent.$('#lqZlTypeInp').val());
									$('.zlTypeRad').each(function(i){
										if($('.zlTypeRad').eq(i).val() == parent.$('#lqZlTypeInp').val()){
											$('.zlTypeRad').eq(i).attr('checked',true);
										}
									});	
									form.render();	
									_this.getAjNum(parent.$('#lqZlTypeInp').val());		
									_this.getEwYqList(parent.$('#lqZlTypeInp').val());		
									tmpEwyqIdArray.length = 0;		
									parent.addZlFlag = false;
						  		}
						  	}
						});	
					});
					//重置已选择的专利领取任务
					$('.resetSp').on('click',function(){
						if($('#pubZlIdInp').val() != ''){
							layer.confirm('确认要清空当前已选择的领取任务？', {
							  title:'提示',
							  skin: 'layui-layer-molv',
							  btn: ['确定','取消'] //按钮
							},function(index){
								$('#pubZlIdInp').val('');
								parent.$('#lqZlIdInp').val('');
								$('#pubZlIdInpTxt').val('');
								parent.$('#lqZlIdInpText').val('');
								layer.close(index);
							});
						}
					});
					//添加技术领域
					$('#addFieldBtn').on('click',function(){
						layer.open({
							title:'添加专业领域',
							type: 2,
						  	area: ['500px', '320px'],
						  	fixed: true, //不固定
						  	maxmin: false,
						  	shadeClose :false,
						  	content: '/Module/zlBasicInfoManager/jsp/addZyField.html'
						});	
					});
					//添加申请人
					$('#addSqrBtn').on('click',function(){
						layer.open({
							title:'添加申请人',
							type: 2,
						  	area: ['720px', '350px'],
						  	fixed: true, //不固定
						  	maxmin: false,
						  	shadeClose :false,
						  	content: '/Module/zlBasicInfoManager/jsp/addSqr.html'
						});	
					});
					//添加联系人
					$('#addlxrBtn').on('click',function(){
						_this.commonLayerLxrFmr('添加联系人');
						addEditLxrOpts = tmpLxrFmrOpts = $(this).attr('opts');
						if($('#lxrBox p').length > 0 /*&& isHasLxrFlag*/){
							//表示已经创建了联系人，假如删除了某个申请人，此时应该从新匹配lxrIdArray lxrIdNum
							lxrIdArray.length = 0;
							lxrIdNum.length = 0;
							$('#lxrBox p').each(function(i){
								lxrIdArray.push($('#lxrBox p').eq(i).attr('id'));
								lxrIdNum.push($('#lxrBox p').eq(i).attr('id').split('_')[1]);
							});
						}else{
							lxrIdArray.length = 0;
							lxrIdNum.length = 0;
						}
					});
					//添加发明人
					$('#addFmrBtn').on('click',function(){
						_this.commonLayerLxrFmr('添加发明人');
						addEditFmrOpts = tmpLxrFmrOpts = $(this).attr('opts');
						if($('#fmrBox p').length > 0 /*&& isHasFmrFlag*/){
							//表示已经创建了发明人，假如删除了某个申请人，此时应该从新匹配fmrIdArray fmrIdNum
							fmrIdArray.length = 0;
							fmrIdNum.length = 0;
							$('#fmrBox p').each(function(i){
								fmrIdArray.push($('#fmrBox p').eq(i).attr('id'));
								fmrIdNum.push($('#fmrBox p').eq(i).attr('id').split('_')[1]);
							});
						}else{
							fmrIdArray.length = 0;
							fmrIdNum.length = 0;
						}
					});
					//添加技术联系人
					$('#addJsLxrBtn').on('click',function(){
						_this.commonLayerLxrFmr('添加技术联系人');
						addEditFmrOpts = tmpLxrFmrOpts = $(this).attr('opts');
						if($('#techLxrBox p').length > 0 /*&& isHasJsLxrFlag*/){
							//表示已经创建了技术联系人，假如删除了某个申请人，此时应该从新匹配jsLxrIdArray jsLxrIdNum
							jsLxrIdArray.length = 0;
							jsLxrIdNum.length = 0;
							$('#techLxrBox p').each(function(i){
								jsLxrIdArray.push($('#techLxrBox p').eq(i).attr('id'));
								jsLxrIdNum.push($('#techLxrBox p').eq(i).attr('id').split('_')[1]);
							});
						}else{
							jsLxrIdArray.length = 0;
							jsLxrIdNum.length = 0;
						}
					});
					//添加优先权
					$('#addYxqBtn').on('click',function(){
						var strHtml = '';
						num ++;
						if($('.innerYxqBox').length > 4){
							layer.msg('抱歉，最多可以添加5个优先权', {icon:5,anim:6,time:1000});
							return;
						}
						strHtml += '<div class="innerYxqBox">';
						strHtml += '<input placeholder="请输入案件申请号/专利号" type="text" autocomplete="off" class="layui-input zlAjNumInp"/>';
						strHtml += '<div class="innerSelAddBox"><select class="zlYxqAreaInp" lay-filter="selAreaFilter">';
						strHtml += '<option value="">请选择申请地区</option>';
						strHtml += '<option value="中国">中国[CN]</option>';
						strHtml += '<option value="中国香港">中国香港[HK]</option>';
						strHtml += '<option value="中国台湾">中国台湾[TW]</option>';
						strHtml += '<option value="澳门">澳门[MO]</option>';
						strHtml += '<option value="日本">日本[JP]</option></select></div>';
						strHtml += '<input placeholder="请选择日期" type="text" name="" autocomplete="off" id="dateInp_'+ num +'" class="layui-input yxqInpDate"/>';
						strHtml += '<i class="layui-icon layui-icon-delete delYxqIcon"  title="删除"></i>';
						strHtml += '</div>';
						$('#innerYxqBox').append(strHtml);
						form.render();
						laydate.render({
							elem:'#dateInp_' + num
						});
						_this.delYxq();				
					});
					//保存增加的专利
					$('#saveZlBtn').on('click',function(){
						var sqrName='', ajTitleVal = $.trim($('#ajTitleInp').val()),//案件标题
							//ajNumInpVal = $('#ajNumInp').val(),//案件编号
							zlTypeInpVal = $('#zlTypeInp').val(),//专利类型
							ajFieldIdVal = $('#ajFieldId').val(),//案件技术领域
							ajSqAddressVal = $('#ajSqAddress').val(),//案件申请地区
							ajSqrIdVal = $('#ajSqrId').val(),//案件申请人
							ajLxrIdVal = $('#ajLxrId').val(),//案件联系人
							ajFmrIdVal = $('#ajFmrId').val(),//案件发明人
							jsLxrIdInpVal = $('#jsLxrIdInp').val(),//技术联系人
							yxqDetailInpVal = $('#yxqDetailInp').val(),//案件优先权
							//fujianInpVal = $('#fujianInp').val(),//案件附件
							ajEwyqIdVal = $('#ajEwyqId').val(),//案件额外要求
							ajRemarkVal = $('#ajRemark').val(),//案件备注
							cpyDateInpVal = $('#cpyDateInp').val(),//定稿提交截至时间
							pubZlIdInpVal = $('#pubZlIdInp').val(),//已领取专利任务
							url = '';
							
						ajFieldIdVal = _this.getIdStr('delFieldBtn','jffieldattrid');
						ajSqrIdVal = _this.getIdStr('delSqrBtn','sqrattrid');
						sqrName = _this.getIdStr('delSqrBtn','sqrattrname');
						ajLxrIdVal = _this.getIdStr('delLxrBtn','lxridattr');
						ajFmrIdVal = _this.getIdStr('delFmrBtn','fmridattr');
						ajJsLxrIdVal = _this.getIdStr('delJsLxrBtn','fmridattr');
						//alert(ajFieldIdVal + "----" + ajSqrIdVal + "--" + ajLxrIdVal + "--" + ajFmrIdVal + "----@@" + ajJsLxrIdVal)
						if(tmpEwyqIdArray.length != 0){
							$('#tmpAjEwyqId').val(tmpEwyqIdArray.join(','));
							ajEwyqIdVal = $('#tmpAjEwyqId').val();
						}else{
							$('#tmpAjEwyqId').val(0);
						}
						if(ajTitleVal == ''){
							layer.msg('案件标题不能为空', {icon:5,anim:6,time:1000});
						}else if(zlTypeInpVal == ''){
							layer.msg('请选择专利类型', {icon:5,anim:6,time:1000});
						}else if(ajFieldIdVal == ''){
							layer.msg('请选择案件所属技术领域', {icon:5,anim:6,time:1000});
						}else if(ajSqAddressVal == ''){
							layer.msg('请选择案件申请地区', {icon:5,anim:6,time:1000});
						}else if(ajSqrIdVal == ''){
							layer.msg('请添加申请人', {icon:5,anim:6,time:1000});
						}else if(ajJsLxrIdVal == ''){
							layer.msg('请添加技术联系人', {icon:5,anim:6,time:1000});
						}else if(cpyDateInpVal == ''){
							layer.msg('定稿提交截止时间不能为空', {icon:5,anim:6,time:1000});
						}else{
							if($('.innerYxqBox').length > 0){
								var strResult = _this.getYxqId();
								if(strResult != undefined){
									yxqDetailInpVal = strResult;
								}else{
									//表明现在还有已经增加好但是没有填写完整的表单
									return;
								}
							}else{
								yxqDetailInpVal = '';
							}
							$('#tmpAjEwyqId').val() == '' ? ajEwyqIdVal = 0 : ajEwyqIdVal = $('#tmpAjEwyqId').val();
							var isHasUpLoadFlag = false;
							if($('.deleteBtn').length > 0){
								if($('input[name="hasUpSuccInp"]').length == 0){//表示用户选择了文件，但是没有点击上传
									isHasUpLoadFlag = false;
								}else if($('input[name="hasUpSuccInp"]').length > 0 && $('input[name="notUpInp"]').length == 0){
									//表示用户选择了文件并且全部上传了
									isHasUpLoadFlag = true;
								}else if($('input[name="hasUpSuccInp"]').length > 0 && $('input[name="notUpInp"]').length > 0 && errorTypeFlag == false){
									//表示用户选择了文件并且上传了，然后用户又选择了文件但是并没有上传(格式都是正确的时候)
									isHasUpLoadFlag = false;
								}else if($('input[name="hasUpSuccInp"]').length > 0 && $('input[name="notUpInp"]').length > 0 && errorTypeFlag == true){
									//表示用户选择了文件并且上传了，然后用户又选择了文件但是并没有上传(格式有部分不正确，用户如果没有点击删除不正确按钮，点击保存直接保存)
									isHasUpLoadFlag = true;
								}
								if(isHasUpLoadFlag){
									upSuccSrcArray.length = 0;
									$('input[name="hasUpSuccInp"]').each(function(i){
										upSuccSrcArray.push($('input[name="hasUpSuccInp"]').eq(i).val());
									});
									$('#fujianInp').val(upSuccSrcArray.join(','));
								}else{
									layer.msg('您有未上传的附件，请先上传附件',{icon:5,anim:6,time:1000});
									return;
								}
							}
							if(addEditZlOpts == 'editZlOpts'){
								url = '/zlm.do?action=updateZlBasicInfo&zlId=' + zlId;
							}else{
								//表示增加专利
								var url = '/zlm.do?action=addZlData';	
			   				}
			   				//console.log(ajTitleVal + "--" +zlTypeInpVal + "-" + ajFieldIdVal + "-" + ajSqAddressVal + "--" + ajSqrIdVal + "-" + ajLxrIdVal+"-"+ajFmrIdVal+"-"+yxqDetailInpVal+"-"+ajEwyqIdVal+"-"+ajRemarkVal+"-"+$('#fujianInp').val()+"-"+cpyDateInpVal+"-pubZlId=="+pubZlIdInpVal + "-----sqrNmme----" + sqrName)
			   				var field = {ajTitle:escape(ajTitleVal),
												ajType:zlTypeInpVal,ajFieldId:ajFieldIdVal,ajSqAddress:escape(ajSqAddressVal),
												ajSqrId:ajSqrIdVal,ajSqrName:escape(sqrName),ajLxrId:ajLxrIdVal,ajFmrId:ajFmrIdVal,jsLxrId:ajJsLxrIdVal,
												yxqDetail:yxqDetailInpVal,ajEwyqId:ajEwyqIdVal,ajRemark:escape(ajRemarkVal),
												ajUpload:$('#fujianInp').val(),cpyDate:cpyDateInpVal,pubZlId:pubZlIdInpVal};
			   				layer.load('1');
							$.ajax({
			   					type:'post',
			   			        async:false,
			   			        dataType:'json',
			   			        data:field,
			   			        url:url,
			   			        success:function (json){
			   			        	layer.closeAll('loading');
			   			        	//console.log(json)
			   			        	if(json['result'] == 'success'){
			   			        		function callBackSucc(){
			   			        			var index= parent.layer.getFrameIndex(window.name);
					        				parent.addZlFlag = true;
					        				parent.layer.close(index);
			   			        		}
			   			        		if(addEditZlOpts == 'editZlOpts'){
			   			        			layer.msg('编辑专利成功',{icon:1,time:1000},callBackSucc);
			   			        		}else{
			   			        			layer.msg('添加专利成功',{icon:1,time:1000},callBackSucc);
			   			        		}
			   			        	}else if(json['result'] == 'noAbility'){
			   			        		layer.msg('抱歉，您暂无权限添加编辑专利', {icon:5,anim:6,time:1000});
			   			        	}else if(json['result'] == 'error'){
			   			        		layer.msg('系统错误，请稍后重试', {icon:5,anim:6,time:1000});
			   			        	}else if(json['result'] == 'typeDiff'){
			   			        		layer.msg('选择的专利类型和专利任务类型不一致', {icon:5,anim:6,time:2200});
			   			        	}else if(json['result'] == 'notUpdate'){
			   			        		layer.msg('定稿以后或专利状态终止条件下不能修改', {icon:5,anim:6,time:2200});
			   			        	}else if(json['result'] == 'addError'){
			   			        		layer.msg('当前选择的专利任务已被其他专利占用！', {icon:5,anim:6,time:2200});
			   			        	}
			   			        }
			   				});
						}
					});
				},
				//添加编辑流程分配人员事件方法
				bindEvent_lcfp : function(){
					var _this = this;
					//增加专利撰写人员
					$('#addZxPeople').on('click',function(){
						globalTypeUser = $(this).attr('opt');
						_this.commonLayerOpen('增加专利撰写人');
					});
					//专利审查人员
					$('#addZlShPeople').on('click',function(){
						globalTypeUser = $(this).attr('opt');
						_this.commonLayerOpen('增加专利审查人员');
					});
					//定稿提交人员 
					$('#addDinggao').on('click',function(){
						globalTypeUser = $(this).attr('opt');
						_this.commonLayerOpen('增加定稿提交人员');
					});
					//导入通知书人员
					$('#addTzs').on('click',function(){
						globalTypeUser = $(this).attr('opt');
						_this.commonLayerOpen('增加通知书导入人员');
					});
					//费用催缴人员
					$('#addFeiyong').on('click',function(){
						globalTypeUser = $(this).attr('opt');
						_this.commonLayerOpen('增加费用催缴人员');
					});
					//专利补正人员
					$('#addBuzheng').on('click',function(){
						globalTypeUser = $(this).attr('opt');
						_this.commonLayerOpen('增加专利补正人员');
					});
					//补正审核人员
					$('#addShBz').on('click',function(){
						globalTypeUser = $(this).attr('opt');
						_this.commonLayerOpen('增加补正审核人员');
					});
					//专利驳回人员
					$('#addBohui').on('click',function(){
						globalTypeUser = $(this).attr('opt');
						_this.commonLayerOpen('增加专利驳回人员');
					});
					//客户确认人员 
					$('#addCusSure').on('click',function(){
						globalTypeUser = $(this).attr('opt');
						_this.commonLayerOpen('增加客户确认人员');
					});
					$('#saveLcFpBtn').on('click',function(){
						var zxUserId = $('#addZxUser_con').attr('userId'),
							checkUserId = $('#addZlShUser_con').attr('userId'),
							tjUserId = $('#addDingGaoUser_con').attr('userId'),
							tzsUserId = $('#addTongZhiShuUser_con').attr('userId'),
							feeUserId = $('#addFeeUser_con').attr('userId'),
							bzUserId = $('#addBuZhengUser_con').attr('userId'),
							bzshUserId = $('#addBuzhengShUser_con').attr('userId'),
							bhUserId = $('#addZlBhUser_con').attr('userId'),
							cusSuerUserId = $('#addCusSureUser_con').attr('userId');
						if(zxUserId == undefined || zxUserId==''){
							zxUserId = 0;
						}
						if(checkUserId == undefined || checkUserId == ''){
							layer.msg('请选择专利审核人员！', {icon:5,anim:6,time:1500});
						}else if(cusSuerUserId == undefined || cusSuerUserId==''){
							layer.msg('请选择客户确认人员！', {icon:5,anim:6,time:1500});
						}else if(tjUserId == undefined || tjUserId == ''){
							layer.msg('请选择定稿提交人员！', {icon:5,anim:6,time:1500});
						}else if(tzsUserId == undefined || tzsUserId ==''){
							layer.msg('请选择通知书导入人员！', {icon:5,anim:6,time:1500});
						}else if(feeUserId == undefined || feeUserId==''){
							layer.msg('请选择费用催缴人员！', {icon:5,anim:6,time:1500});
						}else if(bzUserId == undefined || bzUserId==''){
							layer.msg('请选择专利补正人员！', {icon:5,anim:6,time:1500});
						}else if(bzshUserId == undefined || bzshUserId==''){
							layer.msg('请选择专利补正审核人员！', {icon:5,anim:6,time:1500});
						}else if(bhUserId == undefined || bhUserId==''){
							layer.msg('请选择专利驳回人员！', {icon:5,anim:6,time:1500});
						}else{
							//alert(zxUserId + "=zxUserId-" + checkUserId + "=checkUserId-" + tjUserId + "=tjUserId-" + tzsUserId + "=tzsUserId-" + feeUserId + "=feeUserId-" + bzUserId + "=bzUserId-" + bzshUserId + "=bzshUserId-" + bhUserId + "=bhUserId" + cusSuerUserId + "==cusSuerUserId")
							var field={zlId:parent.globalZlId,zxUserId:zxUserId,checkUserId:checkUserId,tjUserId:tjUserId,tzsUserId:tzsUserId,
									feeUserId:feeUserId,bzUserId:bzUserId,bzshUserId:bzshUserId,bhUserId:bhUserId,cusCheckUserId:cusSuerUserId};
							$.ajax({
		  						type:'post',
						        async:false,
						        dataType:'json',
						        data : field,
						        url:'/zlm.do?action=updateOperatorUserInfo',
						        success:function (json){
						        	layer.closeAll('loading');
						        	console.log(json)
						        	if(json['result'] == 'success'){
						        		layer.msg('流程人员分配设置成功',{icon:1,time:1000});
						        	}else if(json['result'] == 'stopInfo'){
						        		layer.msg('案件终止状态下不能进行修改', {icon:5,anim:6,time:2200});
						        	}else if(json['result'] == 'noAbility'){
						        		layer.msg('抱歉，您暂无权限进行流程分配', {icon:5,anim:6,time:2200});	
						        	}else if(json['result'] == 'notUpdate'){
						        		layer.msg('定稿提交以后不能对撰写人、技术审核人员、定稿提交人员进行分配', {icon:5,anim:6,time:2500});
						        	}
						        }
		  					});
						}
					});
				},
				//流程的事件绑定
				bindEvent_lc : function(){
					var _this = this;
					//查看流程明细时间
					$('.viewDetailBtn').on('click',function(e){
						var lcId = $(this).attr('lcId'),lcName = $(this).attr('lcName'),lcNo = $(this).attr('lcNo');
						$('.closeBtns').attr('opts','closeLcMx');
						if(lcNo == 2){
							$('.mxDetailTit').show().addClass('hasPos');
							$('#mxDetailCon').addClass('hasPos');
						}else{
							$('.mxDetailTit').hide().removeClass('hasPos');
							$('#mxDetailCon').removeClass('hasPos');
						}
						$('#lxMxDetailCon').addClass('animation').removeClass('animationClose');
						$('#mxTit').html(lcName + '--明细详情');
						_this.getMxDetailInfo(lcId,lcNo);
						_this.data.actGetMxFlag = true;
						e.stopPropagation();
					});
					$('.viewMxBtn').on('click',function(){
						if(_this.data.actGetMxFlag){//表示当前明细详情层已经被打开，点击主流程标题可直接更换明细详情
							var lcId = $(this).attr('lcId'),lcName = $(this).attr('lcName'),lcNo = $(this).attr('lcNo');
							if(lcNo == '2'){
								$('.mxDetailTit').show().addClass('hasPos');
								$('#mxDetailCon').addClass('hasPos');
							}else{
								$('.mxDetailTit').hide().removeClass('hasPos');
								$('#mxDetailCon').removeClass('hasPos');
							}
							$('#mxTit').html(lcName + '--明细详情');
							_this.getMxDetailInfo(lcId,lcNo);
						}
					});
				},
				//获取主流程对应的明细详情
				getMxDetailInfo : function(lcId,lcNo){
					var _this = this,noData='<div class="noData" style="display:block;"><i class="iconfont layui-extend-noData"></i><p>暂无明细记录<p></div>';
					$.ajax({
  						type:'post',
				        async:false,
				        dataType:'json',
				        data : {lcId : lcId},
				        url:'/zlm.do?action=getLcMxDetail',
				        success:function (json){
				        	layer.closeAll('loading');
				        	console.log(json)
				        	if(json['result'] == 'success'){
				        		_this.loadLxMxDetail(json,lcNo);
				        	}else if(json['result'] == 'noInfo'){
				        		$('#mxDetailCon').html(noData);
				        	}
				        }
  					});
				},
				//获取优先权
				getYxqId : function(){
					var _this = this,totalRes='';
					var totalFlag=false,tmpZlAjNumFlag=true, tmpZlYxqAreaFlag = true,tmpZlYxqDateFlag=true,zlAjNum = '',totalZlAjNum='',zlYxqArea = '',totalZlYxqArea='',zlYxqDate = '',totalZlYxqDate='';
					$('.zlAjNumInp').each(function(i){
						if($('.zlAjNumInp').eq(i).val() == ''){
							tmpZlAjNumFlag = false;
						}
						if($('.zlAjNumInp').length == 1){
							zlAjNum = $('.zlAjNumInp').eq(i).val();
							totalZlAjNum = zlAjNum;
						}else{
							zlAjNum += $('.zlAjNumInp').eq(i).val() + ',';
							totalZlAjNum = zlAjNum.substring(0,zlAjNum.length-1);
						}
					});
					$('.zlYxqAreaInp').each(function(i){
						if($('.zlYxqAreaInp').eq(i).val() == ''){
							tmpZlYxqAreaFlag = false;
						}
						if($('.zlYxqAreaInp').length == 1){
							zlYxqArea = $('.zlYxqAreaInp').eq(i).val();
							totalZlYxqArea = zlYxqArea;
						}else{
							zlYxqArea += $('.zlYxqAreaInp').eq(i).val() + ',';
							totalZlYxqArea = zlYxqArea.substring(0,zlYxqArea.length-1);
						}
					});
					$('.yxqInpDate').each(function(i){
						if($('.yxqInpDate').eq(i).val() == ''){
							tmpZlYxqDateFlag = false;
						}
						if($('.yxqInpDate').length == 1){
							zlYxqDate = $('.yxqInpDate').eq(i).val();
							totalZlYxqDate = zlYxqDate;
						}else{
							zlYxqDate += $('.yxqInpDate').eq(i).val() + ',';
							totalZlYxqDate = zlYxqDate.substring(0,zlYxqDate.length-1);
						}
					});
					if(!tmpZlAjNumFlag){
						layer.msg('请输入案件申请号/专利号', {icon:5,anim:6,time:1000});
						return;
					}else if(!tmpZlYxqAreaFlag){
						layer.msg('请选择申请地区', {icon:5,anim:6,time:1000});
						return;
					}else if(!tmpZlYxqDateFlag){
						layer.msg('请选择申请时间', {icon:5,anim:6,time:1000});
						return;
					}
					if(tmpZlAjNumFlag &&  tmpZlYxqAreaFlag && tmpZlYxqDateFlag){
						totalFlag = true;
					}	
					if(totalFlag){				
						totalRes = totalZlAjNum + ':' + totalZlYxqArea + ':' + totalZlYxqDate;
						return totalRes;
					}
						
				},
				//获取案件技术领域/案件申请人、联系人、发明人的公共方法
				getIdStr : function(obj,attrName){
					var tmpIdArray=[],strId = '';
					$('.'+obj).each(function(i){
						tmpIdArray.push($('.'+obj).eq(i).attr(attrName));
					});
					strId = tmpIdArray.join(',');
					return strId;
				},
				//删除添加的优先权
				delYxq : function(){
					$('.delYxqIcon').on('click',function(){
						$(this).parent().remove();
						return false;
					});
				},
				//发明人联系公共弹窗
				commonLayerLxrFmr : function(title,opts){
					var _this = this;
					if(sqrArray.length == 0){
						layer.msg('请先添加申请人', {icon:5,anim:6,time:1000});
						return;
					}
					layer.open({
						title:title,
						type: 2,
					  	area: ['720px', '380px'],
					  	fixed: true, //不固定
					  	maxmin: false,
					  	shadeClose :false,
					  	content: '/Module/zlBasicInfoManager/jsp/addLxr.html'
					});	
				},
				//获取定稿提交截至时间
				getCpyDate : function(){
					var date1 = new Date();
					var date2 = new Date(date1);
					date2.setDate(date1.getDate()+30);
					var defaultVal = date2.getFullYear() + "-" + (date2.getMonth()+1) + "-" + date2.getDate();
					laydate.render({
						elem: '#cpyDateInp',
						value : defaultVal
					});
				},
				//获取案件额外要求记录
				getEwYqList : function(yqType){
					var _this = this;
					$.ajax({
	   					type:'post',
	   			        async:false,
	   			        dataType:'json',
	   			        data:{yqType : yqType},
	   			        url:'/zlyq.do?action=getZlyqData',
	   			        success:function (json){
	   			        	layer.closeAll('loading');
	   			        	var yqInfo = json.yqInfo;
	   			        	if(json['result'] == 'success'){
	   			        		_this.renderZlYq(yqInfo);
	   			        	}else if(json['result'] == 'noAbility'){
	   			        		$('#ewyqBpx').html('<p class="noYqData"><i class="layui-icon layui-icon-face-cry"></i>抱歉，您暂无权限获取专利额外要求列表</p>');
	   			        	}else if(json['result'] == 'noInfo'){
	   			        		$('#ewyqBpx').html('<p class="noYqData"><i class="layui-icon layui-icon-face-cry"></i>暂无此专利类型的案件专利额外要求，如若需要，请联系超级管理员进行添加</p>');
	   			        	}
	   			        }
	   				});
				},
				//获取案件编号
				getAjNum : function(yqType){
					layer.load('1');
					$.ajax({
	   					type:'post',
	   			        async:false,
	   			        dataType:'json',
	   			        data:{ajType : yqType},
	   			        url:'/zlm.do?action=getCurrAjNo',
	   			        success:function (json){
	   			        	layer.closeAll('loading');
	   			        	if(json['result'] == 'success'){
	   			        		$('#ajNumInp').val(json['currNextAjNo']);
	   			        	}else if(json['result'] == 'error'){
	   			        		layer.msg('系统错误，请稍后重试', {icon:5,anim:6,time:1000});
	   			        	}
	   			        }
	   				});
				},
				//更加选择的专利类型加载对应的专利额外要求
				renderZlYq : function(yqInfo){
					var strHtml = '';
					for(var i=0;i<yqInfo.length;i++){
						strHtml += '<input type="checkbox" name="zlYqInfoInp" lay-filter="ewyqFilter" value="'+ yqInfo[i].id +'" title="'+ yqInfo[i].yqContent +'" lay-skin="primary"/>';
					}
					$('#ewyqBpx').html(strHtml);
					form.render();
				},
				//编辑时渲染结构
				renderZlBasicInfo : function(json){
					var strHtml = '';
					if(!this.data.upZlFlag){
						//表示不具有编辑权限
						strHtml += '<div class="noUpTipTxt"><i class="layui-icon layui-icon-face-cry"></i>抱歉，您暂无编辑此专利的权限！</div>';
					}
					//案件标题
					strHtml += '<div class="layui-form-item"><label class="layui-form-label"><span>*</span>案件标题</label><div class="layui-input-block">';
					strHtml += '<input id="ajTitleInp" type="text" name="ajTitle" placeholder="请输入案件标题(40字以内)" maxlength="40" value="'+ json.ajTitle +'" autocomplete="off" class="layui-input"/></div></div>';
					//案件编号 && 案件申请号/专利号
					strHtml += '<div class="layui-form-item clearfix"><div class="itemDiv"><label class="layui-form-label">案件编号</label><div class="layui-input-inline">';
					strHtml += '<input id="ajNumInp" type="text" disabled autocomplete="off" value="'+ json.ajNo +'" class="layui-input"/></div></div>';
					strHtml += '<div class="itemDiv"><label class="layui-form-label">案件申请号/专利号</label><div class="layui-input-inline">';
					strHtml += '<input id="ajSqZlNum" type="text" name="ajSqZlNum" disabled autocomplete="off" value="'+ json.ajNoGf +'" class="layui-input"/></div></div></div>';
					//专利类型 && 已领取专利任务
					strHtml += '<div class="layui-form-item clearfix">';
					strHtml += '<div class="itemDiv"><label class="layui-form-label"><span>*</span>专利类型</label><input id="zlTypeInp" name="ajType" type="hidden" value="'+ json.ajType +'"/><div class="layui-input-inline">';
					if(json.ajType == 'fm'){
						strHtml += '<input type="radio" name="zlTypeRad" class="zlTypeRad" lay-filter="zlTypeFilter" value="fm" title="发明" checked/>';
						strHtml += '<input type="radio" name="zlTypeRad" class="zlTypeRad" lay-filter="zlTypeFilter" value="syxx" title="实用新型"/>';
						strHtml += '<input type="radio" name="zlTypeRad" class="zlTypeRad" lay-filter="zlTypeFilter" value="wg" title="外观"/>';
					}else if(json.ajType == 'syxx'){
						strHtml += '<input type="radio" name="zlTypeRad" class="zlTypeRad" lay-filter="zlTypeFilter" value="fm" title="发明"/>';
						strHtml += '<input type="radio" name="zlTypeRad" class="zlTypeRad" lay-filter="zlTypeFilter" value="syxx" title="实用新型" checked/>';
						strHtml += '<input type="radio" name="zlTypeRad" class="zlTypeRad" lay-filter="zlTypeFilter" value="wg" title="外观"/>';
					}else if(json.ajType == 'wg'){
						strHtml += '<input type="radio" name="zlTypeRad" class="zlTypeRad" lay-filter="zlTypeFilter" value="fm" title="发明"/>';
						strHtml += '<input type="radio" name="zlTypeRad" class="zlTypeRad" lay-filter="zlTypeFilter" value="syxx" title="实用新型"/>';
						strHtml += '<input type="radio" name="zlTypeRad" class="zlTypeRad" lay-filter="zlTypeFilter" value="wg" title="外观" checked/>';
					}
					strHtml += '</div></div>';
					//已领取专利任务
					strHtml += '<div class="itemDiv"><label class="layui-form-label">已领取专利任务</label><div class="layui-input-inline">';
					strHtml += '<input id="pubZlIdInp" type="hidden" value="'+ json.pubZlId +'" name="pubZlId"/>';
					strHtml += '<input id="pubZlIdInpTxt" type="text" disabled autocomplete="off" value="'+ json.pubZlName +'" class="layui-input" style="width:94%"/>';
					if(this.data.upZlFlag){
						strHtml += '<span class="selZlTaskSp" title="选择"><i class="layui-icon layui-icon-more"></i></span>';
						strHtml += '<span class="resetSp" title="重置"><i class="layui-icon layui-icon-delete"></i></span>';
					}
					strHtml += '</div></div></div>';
					//案件技术领域
					strHtml += '<div class="layui-form-item"><label class="layui-form-label"><span>*</span>案件技术领域</label><div class="layui-input-block fixHeiDiv clearfix">';
					strHtml += '<div id="fieldBox" class="multiBox fl">';
					for(var i=0;i<json.jsFieldInfo.length;i++){
						if(json.jsFieldInfo[i].checked){
							strHtml += '<p id="fieldId_'+ json.jsFieldInfo[i].jsId +'" jffieldattrid="'+ json.jsFieldInfo[i].jsId +'" class="delFieldBtn"><span>'+ json.jsFieldInfo[i].jsName +'</span><i class="layui-icon layui-icon-close"></i></p>';	
							fieldArray.push('fieldId_'+json.jsFieldInfo[i].jsId);
						}
					}
					strHtml += '<input id="ajFieldId" type="hidden" name="ajFieldId"/></div>';
					if(this.data.upZlFlag){
						strHtml += '<span id="addFieldBtn" class="addSpan fl">添加技术领域</span></div></div>';
					}else{
						strHtml += '</div></div>';
					}
					//案件申请地区
					strHtml += '<div class="layui-form-item"><label class="layui-form-label"><span>*</span>案件申请地区</label>';
					strHtml += '<input id="ajSqAddress" type="hidden" name="ajSqAddress" value="'+ json.ajAddress +'"/><div class="layui-input-block fixHeiDiv clearfix">';
					if(json.ajAddress == '中国'){
						strHtml += '<input type="radio" name="ajSqRad" lay-filter="ajSqAreaFilter" value="中国" title="中国[CN]" checked/>';
						strHtml += '<input type="radio" name="ajSqRad" lay-filter="ajSqAreaFilter" value="中国香港" title="中国香港[HK]"/>';
						strHtml += '<input type="radio" name="ajSqRad" lay-filter="ajSqAreaFilter" value="中国台湾" title="中国台湾[TW]"/>';
						strHtml += '<input type="radio" name="ajSqRad" lay-filter="ajSqAreaFilter" value="澳门" title="澳门[MO]"/>';
						strHtml += '<input type="radio" name="ajSqRad" lay-filter="ajSqAreaFilter" value="日本" title="日本[JP]"/>';
					}else if(json.ajAddress == '中国香港'){
						strHtml += '<input type="radio" name="ajSqRad" lay-filter="ajSqAreaFilter" value="中国" title="中国[CN]"/>';
						strHtml += '<input type="radio" name="ajSqRad" lay-filter="ajSqAreaFilter" value="中国香港" title="中国香港[HK]" checked/>';
						strHtml += '<input type="radio" name="ajSqRad" lay-filter="ajSqAreaFilter" value="中国台湾" title="中国台湾[TW]"/>';
						strHtml += '<input type="radio" name="ajSqRad" lay-filter="ajSqAreaFilter" value="澳门" title="澳门[MO]"/>';
						strHtml += '<input type="radio" name="ajSqRad" lay-filter="ajSqAreaFilter" value="日本" title="日本[JP]"/>';
					}else if(json.ajAddress == '中国台湾'){
						strHtml += '<input type="radio" name="ajSqRad" lay-filter="ajSqAreaFilter" value="中国" title="中国[CN]"/>';
						strHtml += '<input type="radio" name="ajSqRad" lay-filter="ajSqAreaFilter" value="中国香港" title="中国香港[HK]"/>';
						strHtml += '<input type="radio" name="ajSqRad" lay-filter="ajSqAreaFilter" value="中国台湾" title="中国台湾[TW]" checked/>';
						strHtml += '<input type="radio" name="ajSqRad" lay-filter="ajSqAreaFilter" value="澳门" title="澳门[MO]"/>';
						strHtml += '<input type="radio" name="ajSqRad" lay-filter="ajSqAreaFilter" value="日本" title="日本[JP]"/>';
					}else if(json.ajAddress == '澳门'){
						strHtml += '<input type="radio" name="ajSqRad" lay-filter="ajSqAreaFilter" value="中国" title="中国[CN]"/>';
						strHtml += '<input type="radio" name="ajSqRad" lay-filter="ajSqAreaFilter" value="中国香港" title="中国香港[HK]"/>';
						strHtml += '<input type="radio" name="ajSqRad" lay-filter="ajSqAreaFilter" value="中国台湾" title="中国台湾[TW]"/>';
						strHtml += '<input type="radio" name="ajSqRad" lay-filter="ajSqAreaFilter" value="澳门" title="澳门[MO]" checked/>';
						strHtml += '<input type="radio" name="ajSqRad" lay-filter="ajSqAreaFilter" value="日本" title="日本[JP]"/>';
					}else{
						strHtml += '<input type="radio" name="ajSqRad" lay-filter="ajSqAreaFilter" value="中国" title="中国[CN]"/>';
						strHtml += '<input type="radio" name="ajSqRad" lay-filter="ajSqAreaFilter" value="中国香港" title="中国香港[HK]"/>';
						strHtml += '<input type="radio" name="ajSqRad" lay-filter="ajSqAreaFilter" value="中国台湾" title="中国台湾[TW]"/>';
						strHtml += '<input type="radio" name="ajSqRad" lay-filter="ajSqAreaFilter" value="澳门" title="澳门[MO]"/>';
						strHtml += '<input type="radio" name="ajSqRad" lay-filter="ajSqAreaFilter" value="日本" title="日本[JP]" checked/>';
					}
					strHtml += '</div></div>';
					//申请人
					strHtml += '<div class="layui-form-item"><label class="layui-form-label"><span>*</span>申请人</label><input id="sqrIdInp" type="hidden"/>';
					strHtml += '<div class="layui-input-block fixHeiDiv clearfix"><input id="ajSqrId" type="hidden" value="'+ json.sqrId +'" name="ajSqrId"/>'; 
					strHtml += '<div id="sqrBox" class="multiBox fl">';
					var tmpArraySqrId = json.sqrId.split(',');
					var tmpArraySqrName = json.sqrName.split(',');
					sqrIdArray = tmpArraySqrId;
					sqrTxtArray = tmpArraySqrName;
					for(var i=0;i<tmpArraySqrName.length;i++){
						strHtml += '<p id="sqrId_'+ tmpArraySqrId[i] +'" sqrattrname="'+ tmpArraySqrName[i] +'" sqrattrid="'+ tmpArraySqrId[i] +'" class="delSqrBtn"><span>'+ tmpArraySqrName[i] +'</span><i class="layui-icon layui-icon-close"></i></p>';
						sqrArray.push('sqrId_'+tmpArraySqrId[i]);
					}
					strHtml += '</div>';
					if(this.data.upZlFlag){
						strHtml += '<span id="addSqrBtn" class="addSpan fl">添加/编辑申请人</span>';
					}
					strHtml += '</div></div>';
					//联系人
					strHtml += '<div class="layui-form-item"><label class="layui-form-label">联系人</label><div class="layui-input-block fixHeiDiv clearfix">';
					strHtml += '<input id="ajLxrId" type="hidden" value="'+ json.lxrId +'" name="ajLxrId"/><div class="multiBox fl" style="width:100%;">';
					strHtml += '<div id="lxrBox" class="multiBox fl">';
					if(json.lxrId != ''){
						var tmpArrayLxrId = json.lxrId.split(',');
						var tmpArrayLxrName = json.lxrName.split(',');
						var tmpArraySqrLxrId = json.sqrLxrId.split(',');
						lxrIdNum = tmpArrayLxrId;
						for(var i=0;i<tmpArrayLxrName.length;i++){
							strHtml += '<p id="lxrId_'+ tmpArrayLxrId[i] +'" lxridattr="'+ tmpArrayLxrId[i] +'" sqrids="'+ tmpArraySqrLxrId[i] +'" class="lxFmTag delLxrBtn"><input type="hidden" class="lxrFmrInpHid" name="myParSqr_'+ tmpArraySqrLxrId[i] +'"><span>'+ tmpArrayLxrName[i] +'</span><i class="layui-icon layui-icon-close"></i></p>';
						}
					}
					strHtml += '</div>';
					if(this.data.upZlFlag){
						strHtml += '<span id="addlxrBtn" opts="addLxrOpts" class="addSpan fl">添加/编辑联系人</span></div>';
					}
					strHtml += '</div></div>';		
					//发明人
					strHtml += '<div class="layui-form-item"><label class="layui-form-label">发明人</label><div class="layui-input-block fixHeiDiv clearfix">';
					strHtml += '<input id="ajFmrId" type="hidden" name="ajFmrId" value="'+ json.fmrId +'"/><div class="multiBox fl" style="width:100%;">';
					strHtml += '<div id="fmrBox" class="multiBox fl">';	
					if(json.fmrId != ''){
						var tmpArrayFmrId = json.fmrId.split(',');
						var tmpArrayFmrName = json.fmrName.split(',');
						var tmpArraySqrFmrId = json.sqrFmrId.split(',');
						fmrIdNum = tmpArrayFmrId;
						for(var i=0;i<tmpArrayFmrName.length;i++){
							strHtml += '<p id="fmrId_'+ tmpArrayFmrId[i] +'" fmridattr="'+ tmpArrayFmrId[i] +'" sqrids="'+ tmpArraySqrFmrId[i] +'" class="lxFmTag delFmrBtn"><input type="hidden" class="lxrFmrInpHid" name="myParSqr_'+ tmpArraySqrFmrId[i] +'"><span>'+ tmpArrayFmrName[i] +'</span><i class="layui-icon layui-icon-close"></i></p>';
						}	
					}
					strHtml += '</div>';
					if(this.data.upZlFlag){
						strHtml += '<span id="addFmrBtn" opts="addFmrOpts" class="addSpan fl">添加/编辑发明人</span></div>';
					}
					strHtml += '</div></div>';
					//技术联系人
					strHtml += '<div class="layui-form-item"><label class="layui-form-label"><span>*</span>技术联系人</label><div class="layui-input-block fixHeiDiv clearfix">';
					strHtml += '<input id="jsLxrIdInp" type="hidden" value="'+ json.jsLxrId +'" name="jsLxrIdInp"/><div class="multiBox fl" style="width:100%;">';
					strHtml += '<div id="techLxrBox" class="multiBox fl">';
					if(json.jsLxrId != ''){
						var tmpArrayJsLxrId = json.jsLxrId.split(',');
						var tmpArrayJsLxrName = json.jsLxrName.split(',');
						var tmpArraySqrJsLxrId = json.sqrJsrId.split(',');
						jsLxrIdNum = tmpArrayJsLxrId;
						for(var i=0;i<tmpArrayJsLxrName.length;i++){
							strHtml += '<p id="fmrId_'+ tmpArrayJsLxrId[i] +'" fmridattr="'+ tmpArrayJsLxrId[i] +'" sqrids="'+ tmpArraySqrJsLxrId[i] +'" class="lxFmTag delJsLxrBtn"><input type="hidden" class="lxrFmrInpHid" name="myParSqr_'+ tmpArraySqrJsLxrId[i] +'"><span>'+ tmpArrayJsLxrName[i] +'</span><i class="layui-icon layui-icon-close"></i></p>';
						}
					}
					strHtml += '</div>';
					if(this.data.upZlFlag){
						strHtml += '<span id="addJsLxrBtn" opts="addJsLxrOpts" class="addSpan fl">添加/编辑技术联系人</span></div>';
					}
					strHtml += '</div></div>';
					//案件优先权
					strHtml += '<div class="layui-form-item"><label class="layui-form-label">优先权</label><div class="blockDiv fixHeiDiv clearfix">';
					strHtml += '<input id="yxqDetailInp" type="hidden" name="yxqDetail"/><div id="yxqBox"><div id="innerYxqBox">';
					if(json.ajYxqDetail != ''){
						var tmpYxqZlNum = json.ajYxqDetail.split(':')[0].split(',');
						var tmpYxqSqArea = json.ajYxqDetail.split(':')[1].split(',');
						var tmpYxqDate = json.ajYxqDetail.split(':')[2].split(',');
						num = tmpYxqZlNum.length;
						for(var i=0;i<tmpYxqZlNum.length;i++){
							strHtml += '<div class="innerYxqBox">';
							strHtml += '<input placeholder="请输入案件申请号/专利号" type="text" value="'+ tmpYxqZlNum[i] +'" autocomplete="off" class="layui-input zlAjNumInp"/>';
							strHtml += '<div class="innerSelAddBox"><select class="zlYxqAreaInp" lay-filter="selAreaFilter">';
							strHtml += '<option value="">请选择</option>';
							if(tmpYxqSqArea[i] == '中国'){
								strHtml += '<option value="中国" selected>中国[CN]</option>';
								strHtml += '<option value="中国香港">中国香港[HK]</option>';
								strHtml += '<option value="中国台湾">中国台湾[TW]</option>';
								strHtml += '<option value="澳门">澳门[MO]</option>';
								strHtml += '<option value="日本">日本[JP]</option>';
							}else if(tmpYxqSqArea[i] == '中国香港'){
								strHtml += '<option value="中国">中国[CN]</option>';
								strHtml += '<option value="中国香港" selected>中国香港[HK]</option>';
								strHtml += '<option value="中国台湾">中国台湾[TW]</option>';
								strHtml += '<option value="澳门">澳门[MO]</option>';
								strHtml += '<option value="日本">日本[JP]</option>';
							}else if(tmpYxqSqArea[i] == '中国台湾'){
								strHtml += '<option value="中国">中国[CN]</option>';
								strHtml += '<option value="中国香港">中国香港[HK]</option>';
								strHtml += '<option value="中国台湾" selected>中国台湾[TW]</option>';
								strHtml += '<option value="澳门">澳门[MO]</option>';
								strHtml += '<option value="日本">日本[JP]</option>';
							}else if(tmpYxqSqArea[i] == '澳门'){
								strHtml += '<option value="中国">中国[CN]</option>';
								strHtml += '<option value="中国香港">中国香港[HK]</option>';
								strHtml += '<option value="中国台湾">中国台湾[TW]</option>';
								strHtml += '<option value="澳门" selected>澳门[MO]</option>';
								strHtml += '<option value="日本">日本[JP]</option>';
							}else if(tmpYxqSqArea[i] == '日本'){
								strHtml += '<option value="中国">中国[CN]</option>';
								strHtml += '<option value="中国香港">中国香港[HK]</option>';
								strHtml += '<option value="中国台湾">中国台湾[TW]</option>';
								strHtml += '<option value="澳门">澳门[MO]</option>';
								strHtml += '<option value="日本" selected>日本[JP]</option>';
							}
							strHtml += '</select></div>';
							strHtml += '<input placeholder="请选择日期" type="text" name="" autocomplete="off" id="dateInp_'+ (i+1) +'" value="'+ tmpYxqDate[i] +'" class="layui-input yxqInpDate"/>';
							if(this.data.upZlFlag){
								strHtml += '<i class="layui-icon layui-icon-delete delYxqIcon"  title="删除"></i>';
							}
							strHtml += '</div>';
							laydate.render({
								elem:'#dateInp_' + (i+1)
							});
						}
					}
					strHtml += '</div>';
					if(this.data.upZlFlag){
						strHtml += '<span id="addYxqBtn" class="addSpan margLAddSp fl">添加优先权</span></div>';
					}
					strHtml += '</div></div>';
					//案件额外要求
					strHtml += '<div class="layui-form-item"><label class="layui-form-label">案件额外要求</label>';
					strHtml += '<input id="ajEwyqId" type="hidden" name="ajEwyqId"/><input id="tmpAjEwyqId" type="hidden"/>';
					strHtml += '<div id="ewyqBpx" class="layui-input-block">';
					for(var i=0;i<json.yqInfo.length;i++){
						if(json.yqInfo[i].checked){
							strHtml += '<input type="checkbox" name="zlYqInfoInp" lay-filter="ewyqFilter" value="'+ json.yqInfo[i].yqId +'" title="'+ json.yqInfo[i].yaContent +'" lay-skin="primary" checked/>';
							tmpEwyqIdArray.push(json.yqInfo[i].yqId);
						}else{
							strHtml += '<input type="checkbox" name="zlYqInfoInp" lay-filter="ewyqFilter" value="'+ json.yqInfo[i].yqId +'" title="'+ json.yqInfo[i].yaContent +'" lay-skin="primary"/>';	
						}
					}
					strHtml += '</div></div>';
					//案件备注
					strHtml += '<div class="layui-form-item"><label class="layui-form-label">案件备注</label><div class="layui-input-block">';
					strHtml += '<textarea id="ajRemark" name="ajRemark" placeholder="请输入案件备注(80字以内)" class="layui-textarea" maxlength="80">'+ json.ajRemark +'</textarea>';
					strHtml += '</div></div>';
					//定稿提交截至时间
					strHtml += '<div class="layui-form-item"><label class="layui-form-label"><span>*</span>定稿提交截止时间</label><div class="layui-input-inline">';
					strHtml += '<input type="text" class="layui-input" id="cpyDateInp" value="'+ json.cpyDate +'" name="cpyDate"/></div><div class="layui-form-mid layui-word-aux">(系统默认一个月)</div></div>';
					if(this.data.upZlFlag){
					//案件附件
						strHtml += '<div class="layui-form-item"><label class="layui-form-label">案件附件</label><div class="layui-input-block">';
						strHtml += '<button type="button" class="layui-btn layui-btn-normal" id="selFileBtn">选择文件</button>';
						strHtml += '  <span class="noticeSpan">注：附件中单个图片大小不能超过5M，单个文件大小不能超过10M (非必填项)，最多可上传5个文件</span>';
						strHtml += '<button type="button" class="layui-btn" id="upListAction">上传附件</button></div></div>';
						strHtml += '<div class="layui-form-item"><input id="fujianInp" name="zlUpCl" type="hidden"/>';
					}else{
						strHtml += '<div class="layui-form-item"><label class="layui-form-label">案件附件</label><input id="fujianInp" name="zlUpCl" type="hidden"/>';
					}
					strHtml += '<div class="layui-input-block"><table class="layui-table"><thead>';
					strHtml += '<tr><th>附件名</th><th>大小</th><th>状态</th><th>进度</th><th>操作</th></tr></thead>';
					strHtml += '<tbody id="upLoadFileList">';
					var zlUpClArray = json.upFile;
					for(var i=0;i<zlUpClArray.length;i++){
						strHtml += '<tr id="upload-'+ i +'">';
						strHtml += '<td>'+ zlUpClArray[i].fileName +'</td>';
						strHtml += '<td>'+ zlUpClArray[i].fileSize +'</td>';
						strHtml += '<td><span style="color: #5FB878;">上传成功</span></td>';
						strHtml += '<td style="width:120px;"><div class="layui-progress layui-progress-big" lay-showpercent="true">';
						strHtml += '<div class="layui-progress-bar progressBarBg" lay-percent="100%" style="width:100%;"><span class="layui-progress-text">100%</span></div></div>';
						strHtml += '</td>';
						strHtml += '<td>';
						strHtml += '<input class="uploadInpHid" name="hasUpSuccInp" value="'+ zlUpClArray[i].upPath +'" type="hidden"/>';
						if(this.data.upZlFlag){
							strHtml += '<button class="layui-btn layui-btn-xs layui-btn-danger deleteBtn deleteBtn_edit">删除</button>';
						}
						strHtml += '<button class="layui-btn layui-btn-xs downloadBtn" downFilePath="'+ zlUpClArray[i].downFilePath +'">下载</button></td>';
						strHtml += '</tr>';
					}
					strHtml += '</tbody></table>';
					strHtml += '</div></div>';
					if(this.data.upZlFlag){
						//保存按钮
						strHtml += '<div class="layui-form-item"><label class="layui-form-label"></label><div class="layui-input-block" style="width:75%;text-align:center;">';
						strHtml += '<button type="button" id="saveZlBtn" class="layui-btn" style="width:120px;margin-left:0px;">保存专利</button></div></div>';
					}
					$('#addNewZl').html(strHtml);
					form.render();
					if(this.data.upZlFlag){
						if(json.ajYxqDetail != ''){	
							this.delYxq();
						}
						laydate.render({
							elem: '#cpyDateInp'
						});
						selectFileUpload();//编辑时渲染结构完成调用上传方法
						delHasAddMethod('delFieldBtn','delFieldOpt');
						delHasAddMethod('delSqrBtn','delSqrOpt');
						if(json.lxrId != ''){
							delHasAddMethod('delLxrBtn','delLxrOpt');
						}
						if(json.fmrId != ''){
							delHasAddMethod('delFmrBtn','delFmrOpt');
						}
						delHasAddMethod('delJsLxrBtn','delJsLxrOpt');
						if($('.downloadBtn').length > 0){
							$('.downloadBtn').on('click',function(){
								var downFilePath = $(this).attr('downFilePath');
								common.downFiles(downFilePath);
							});
						}
					}
					if(json.pubZlName != ''){//编辑首次进来页面判断是否存在已添加的专利任务存在激活重置
						parent.$('#lqZlIdInp').val(json.pubZlId);//将已经存在数据库的pubZlId赋给父级用于弹窗页面的回显
			  		}
				},
				//渲染流程分配人员结构
				renderLcFpPeo : function(json){
					//console.log(json)
					var strHtml = '',applyYjFlag = json.applyYjFlag;
					if(!this.data.fpZlFlag){
						//表示不具有分配权限
						strHtml += '<div class="noUpTipTxt"><i class="layui-icon layui-icon-face-cry"></i>抱歉，您暂无对此专利分配人员的权限！</div>';
					}else{
						strHtml += '<div class="layui-form-item" style="margin:15px 0 -10px 0;">';
						strHtml += '<p class="lcfpTipsInfo"><i class="layui-icon layui-icon-speaker hasBlink"></i>注：01. 被分配的流程人员需要具有流程处理权限的才能进行分配！</p>';
						strHtml += '<p class="lcfpTipsInfo bigIndent">02. 正在进行中任务的人员请谨慎更换，一旦更换人员，那么此人员所处理的任务将被移除！</p>';
						strHtml += '</div>';
					}
					//专利撰写人员
					strHtml += '<div class="layui-form-item" style="margin-top:15px;"><label class="layui-form-label">专利撰写人员</label>';
					strHtml += '<div class="layui-input-block lcfzWrap clearfix"><div id="zxPeopleBox" class="multiBox fl">';
					if(json.zxUserId != 0){
						strHtml += '<p id="addZxUser_con" userId="'+ json.zxUserId +'"><i class="layui-icon layui-icon-username"></i>'+ json.zxUserName +'</p>';
					}
					strHtml += '</div>';
					if(this.data.fpZlFlag){
						if(this.data.ajStatus < 7.0){
							strHtml += '<span id="addZxPeople" opt="addZxUser" lcfpId="'+ json.zxUserId +'" class="addSpan fl">添加/编辑</span><div class="layui-form-mid layui-word-aux">(注：如若未指定专利撰写人员，需撰写人员本人自行进行任务领取)</div><p id="lcNo3" class="currLcNo"></p>';
						}
					}
					strHtml += '</div></div>';
					//专利审核人员
					strHtml += '<div class="layui-form-item"><label class="layui-form-label"><span>*</span>专利审核人员</label>';
					strHtml += '<div class="layui-input-block lcfzWrap clearfix"><div id="zlShBox" class="multiBox fl">';
					if(json.checkUserId != 0){
						strHtml += '<p id="addZlShUser_con" userId="'+ json.checkUserId +'"><i class="layui-icon layui-icon-username"></i>'+ json.checkUserName +'</p>';
					}
					strHtml += '</div>';
					if(this.data.fpZlFlag){
						if(this.data.ajStatus < 7.0){
							strHtml += '<span id="addZlShPeople" opt="addZlShUser" lcfpId="'+ json.checkUserId +'" class="addSpan fl">添加/编辑</span><p id="lcNo4" class="currLcNo"></p>';	
						}
					}
					strHtml += '</div></div>';
					//客户确认人员
					strHtml += '<div class="layui-form-item"><label class="layui-form-label"><span>*</span>客户确认人员</label>';
					strHtml += '<div class="layui-input-block lcfzWrap clearfix"><div id="cusSureBox" class="multiBox fl">';
					if(json.cusCheckUserId != 0){
						strHtml += '<p id="addCusSureUser_con" userId="'+ json.cusCheckUserId +'"><i class="layui-icon layui-icon-username"></i>'+ json.cusCheckUserName +'</p>';
					}
					strHtml += '</div>';
					if(this.data.fpZlFlag){
						if(this.data.ajStatus < 7.0){
							strHtml += '<span id="addCusSure" opt="addCusSureUser" lcfpId="'+ json.cusCheckUserId +'" class="addSpan fl">添加/编辑</span><p id="lcNo5" class="currLcNo"></p>';
						}
					}
					strHtml += '</div></div>';
					// 定稿提交人员 
					strHtml += '<div class="layui-form-item"><label class="layui-form-label"><span>*</span>定稿提交人员</label>';
					strHtml += '<div class="layui-input-block lcfzWrap clearfix"><div id="dingGaoBox" class="multiBox fl">';
					if(json.tjUserId != 0){
						strHtml += '<p id="addDingGaoUser_con" userId="'+ json.tjUserId +'"><i class="layui-icon layui-icon-username"></i>'+ json.tjUserName +'</p>';
					}
					strHtml += '</div>';
					if(this.data.fpZlFlag){
						if(this.data.ajStatus < 7.0){
							strHtml += '<span id="addDinggao" opt="addDingGaoUser" lcfpId="'+ json.tjUserId +'" class="addSpan fl">添加/编辑</span><p id="lcNo6" class="currLcNo"></p>';
						}
					}
					strHtml += '</div></div>';
					//导入通知书人员
					strHtml += '<div class="layui-form-item"><label class="layui-form-label"><span>*</span>通知书导入人员</label>';
					strHtml += '<div class="layui-input-block lcfzWrap clearfix"><div id="tzsBox" class="multiBox fl">';
					if(json.tzsUserId != 0){
						strHtml += '<p id="addTongZhiShuUser_con" userId="'+ json.tzsUserId +'"><i class="layui-icon layui-icon-username"></i>'+ json.tzsUserName +'</p>';
					}
					strHtml += '</div>';
					if(this.data.fpZlFlag){
						strHtml += '<span id="addTzs" opt="addTongZhiShuUser" lcfpId="'+ json.tzsUserId +'" class="addSpan fl">添加/编辑</span><p id="lcNo7" class="currLcNo"></p>';
					}
					strHtml += '</div></div>';
					//费用催缴人员
					strHtml += '<div class="layui-form-item"><label class="layui-form-label"><span>*</span>费用催缴人员</label>';
					strHtml += '<div class="layui-input-block lcfzWrap clearfix"><div id="feiyongBox" class="multiBox fl">';
					if(json.feeUserId != 0){
						strHtml += '<p id="addFeeUser_con" userId="'+ json.feeUserId +'"><i class="layui-icon layui-icon-username"></i>'+ json.feeUserName +'</p>';
					}
					strHtml += '</div>';
					if(this.data.fpZlFlag){
						strHtml += '<span id="addFeiyong" opt="addFeeUser" lcfpId="'+ json.feeUserId +'" class="addSpan fl">添加/编辑</span><p id="lcNo8" class="currLcNo"></p>';
					}
					strHtml += '</div></div>';
					//专利补正人员
					strHtml += '<div class="layui-form-item"><label class="layui-form-label"><span>*</span>专利补正人员</label>';
					strHtml += '<div class="layui-input-block lcfzWrap clearfix"><div id="buzhengBox" class="multiBox fl">';
					if(json.bzUserId != 0){
						strHtml += '<p id="addBuZhengUser_con" userId="'+ json.bzUserId +'"><i class="layui-icon layui-icon-username"></i>'+ json.bzUserName +'</p>';
					}
					strHtml += '</div>';
					if(this.data.fpZlFlag){
						strHtml += '<span id="addBuzheng" opt="addBuZhengUser" lcfpId="'+ json.bzUserId +'" class="addSpan fl">添加/编辑</span><p id="lcNo9" class="currLcNo"></p>';
					}
					strHtml += '</div></div>';
					//补正审核人员
					strHtml += '<div class="layui-form-item"><label class="layui-form-label"><span>*</span>补正审核人员</label>';
					strHtml += '<div class="layui-input-block lcfzWrap clearfix"><div id="shBzBox" class="multiBox fl">';
					if(json.bzshUserId != 0){
						strHtml += '<p id="addBuzhengShUser_con" userId="'+ json.bzshUserId +'"><i class="layui-icon layui-icon-username"></i>'+ json.bzshUserName +'</p>';
					}
					strHtml += '</div>';
					if(this.data.fpZlFlag){
						strHtml += '<span id="addShBz" opt="addBuzhengShUser" lcfpId="'+ json.bzshUserId +'" class="addSpan fl">添加/编辑</span><p id="lcNo10" class="currLcNo"></p>';
					}
					strHtml += '</div></div>';
					//专利驳回人员
					strHtml += '<div class="layui-form-item"><label class="layui-form-label"><span>*</span>专利驳回人员</label>';
					strHtml += '<div class="layui-input-block lcfzWrap clearfix"><div id="bohuiBox" class="multiBox fl">';
					if(json.bhUserId != 0){
						strHtml += '<p id="addZlBhUser_con" userId="'+ json.bhUserId +'"><i class="layui-icon layui-icon-username"></i>'+ json.bhUserName +'</p>';
					}
					strHtml += '</div>';
					if(this.data.fpZlFlag){
						strHtml += '<span id="addBohui" opt="addZlBhUser" lcfpId="'+ json.bhUserId +'" class="addSpan fl">添加/编辑</span><p id="lcNo11" class="currLcNo"></p>';
					}
					strHtml += '</div></div>';
					if(this.data.fpZlFlag){
						strHtml += '<div class="layui-form-item"><label class="layui-form-label"></label>';
						strHtml += '<div class="layui-input-block" style="width:75%;text-align:center;"><button type="button" id="saveLcFpBtn" class="layui-btn" style="width:120px;margin-left:0px;">保存</button></div></div>';
					}
					$('#addLcFp').html(strHtml);
					this.judgeLcNo(applyYjFlag);
					this.bindEvent_lcfp();
				},
				//根据当前LcNo来判定当前任务到哪一步了(任务移交/任务移交审核时流程分配用来显示当前人员，其他不显示编辑和添加)
				judgeLcNo : function(applyYjFlag){
					var currLcNo = this.data.ajStatus;
					$('.currLcNo').html(this.data.otherLcStr);
					if(currLcNo >= 3 && currLcNo < 4){ //新申请撰稿  撰稿修改nowLcStatus
						applyYjFlag ? $('#lcNo3').html(this.data.nowLcStr + this.data.applyTransStr) : $('#lcNo3').html(this.data.nowLcStr);
						//$('#lcNo3').html(this.data.nowLcStr);
					}else if(currLcNo >= 4 && currLcNo < 5){//专利审核
						$('#lcNo3').html(this.data.hasCompLcStr);
						applyYjFlag ? $('#lcNo4').html(this.data.nowLcStr + this.data.applyTransStr) : $('#lcNo4').html(this.data.nowLcStr);
					}else if(currLcNo >= 5 && currLcNo < 6){//客户确认
						$('#lcNo3').html(this.data.hasCompLcStr);
						$('#lcNo4').html(this.data.hasCompLcStr);
						applyYjFlag ? $('#lcNo5').html(this.data.nowLcStr + this.data.applyTransStr) : $('#lcNo5').html(this.data.nowLcStr);
					}else if(currLcNo >= 6 && currLcNo < 7){//定稿提交
						$('#lcNo3').html(this.data.hasCompLcStr);
						$('#lcNo4').html(this.data.hasCompLcStr);
						$('#lcNo5').html(this.data.hasCompLcStr);
						applyYjFlag ? $('#lcNo6').html(this.data.nowLcStr + this.data.applyTransStr) : $('#lcNo6').html(this.data.nowLcStr);
					}else if(currLcNo >= 7 && currLcNo < 8){//通知书导入
						$('#lcNo3').html(this.data.hasCompLcStr);
						$('#lcNo4').html(this.data.hasCompLcStr);
						$('#lcNo5').html(this.data.hasCompLcStr);
						$('#lcNo6').html(this.data.hasCompLcStr);
						applyYjFlag ? $('#lcNo7').html(this.data.nowLcStr + this.data.applyTransStr) : $('#lcNo7').html(this.data.nowLcStr);
					}else if(currLcNo >= 8 && currLcNo < 9){//费用催缴
						$('#lcNo3').html(this.data.hasCompLcStr);
						$('#lcNo4').html(this.data.hasCompLcStr);
						$('#lcNo5').html(this.data.hasCompLcStr);
						$('#lcNo6').html(this.data.hasCompLcStr);
						$('#lcNo7').html(this.data.hasCompLcStr);
						applyYjFlag ? $('#lcNo8').html(this.data.nowLcStr + this.data.applyTransStr) : $('#lcNo8').html(this.data.nowLcStr);
					}else if(currLcNo >= 9 && currLcNo < 10){//专利补正
						$('#lcNo3').html(this.data.hasCompLcStr);
						$('#lcNo4').html(this.data.hasCompLcStr);
						$('#lcNo5').html(this.data.hasCompLcStr);
						$('#lcNo6').html(this.data.hasCompLcStr);
						$('#lcNo7').html(this.data.hasCompLcStr);
						$('#lcNo8').html(this.data.hasCompLcStr);
						applyYjFlag ? $('#lcNo9').html(this.data.nowLcStr + this.data.applyTransStr) : $('#lcNo9').html(this.data.nowLcStr);
					}else if(currLcNo >= 10 && currLcNo < 11){//补正审核
						$('#lcNo3').html(this.data.hasCompLcStr);
						$('#lcNo4').html(this.data.hasCompLcStr);
						$('#lcNo5').html(this.data.hasCompLcStr);
						$('#lcNo6').html(this.data.hasCompLcStr);
						$('#lcNo7').html(this.data.hasCompLcStr);
						$('#lcNo8').html(this.data.hasCompLcStr);
						$('#lcNo9').html(this.data.hasCompLcStr);
						applyYjFlag ? $('#lcNo10').html(this.data.nowLcStr + this.data.applyTransStr) : $('#lcNo10').html(this.data.nowLcStr);
					}else if(currLcNo >= 11 && currLcNo < 12){//专利驳回
						$('#lcNo3').html(this.data.hasCompLcStr);
						$('#lcNo4').html(this.data.hasCompLcStr);
						$('#lcNo5').html(this.data.hasCompLcStr);
						$('#lcNo6').html(this.data.hasCompLcStr);
						$('#lcNo7').html(this.data.hasCompLcStr);
						$('#lcNo8').html(this.data.hasCompLcStr);
						$('#lcNo9').html(this.data.hasCompLcStr);
						$('#lcNo10').html(this.data.hasCompLcStr);
						applyYjFlag ? $('#lcNo11').html(this.data.nowLcStr + this.data.applyTransStr) : $('#lcNo11').html(this.data.nowLcStr);
					}
				},
				//获取流程明细(主流程)
				loadLcDetail : function(json){
					//console.log(json)
					var lcInfo = json.lcInfo;
					var strHtml = '';
					strHtml += '<ul>';
					for(var i=0,iLen=lcInfo.length;i<iLen;i++){
						if(lcInfo[i].comDate != ''){//表示完成
							strHtml += '<li class="viewMxBtn" lcId="'+ lcInfo[i].lcId +'" lcNo = "'+ lcInfo[i].lcNo +'" lcName="'+ lcInfo[i].lcName +'"><p class="oneWid ellip"><i class="layui-icon layui-icon-ok statusIcon_com" title="已完成"></i>'+ lcInfo[i].lcName +'</p>';
						}else{
							strHtml += '<li class="viewMxBtn" lcId="'+ lcInfo[i].lcId +'" lcNo = "'+ lcInfo[i].lcNo +'" lcName="'+ lcInfo[i].lcName +'"><p class="oneWid ellip"><i class="iconfont layui-extend-jinhangzhong statusIcon" title="进行中"></i>'+ lcInfo[i].lcName +'</p>';
						}
						strHtml += '<p class="twoWid">'+ lcInfo[i].sDate +'</p>';
						strHtml += '<p class="twoWid">'+ lcInfo[i].cpyDate +'</p>';
						if(lcInfo[i].gfDate != ''){
							strHtml += '<p class="twoWid">'+ lcInfo[i].gfDate +'</p>';	
						}else{
							strHtml += '<p class="twoWid">&nbsp;</p>';
						}
						if(lcInfo[i].comDate != ''){
							strHtml += '<p class="twoWid">'+ lcInfo[i].comDate +'</p>';
						}else{
							strHtml += '<p class="twoWid">&nbsp;</p>';
						}
						strHtml += '<p class="threeWid"><a class="viewDetailBtn" href="javascript:void(0)" lcNo="'+lcInfo[i].lcNo  +'" lcId="'+ lcInfo[i].lcId +'" lcName="'+ lcInfo[i].lcName +'">查看明细</a></p></li>';
					}
					strHtml +=  '</ul>';
					$('#lcDetailCon').html(strHtml);
					$('#lcDetailCon li:odd').addClass('oddColor');
					$('#lxMxDetailCon').height($(window).height()-41);
					this.bindEvent_lc();
				},
				//获取流程明细(子流程)
				loadLxMxDetail : function(json,lcNo){
					var mxInfo = json.mxInfo;
					var strHtml = '';
					if(lcNo == 2){
						strHtml += '<ul id="mxDetailConUl">';
						for(var i=0,iLen = mxInfo.length;i<iLen;i++){
							strHtml += '<li><p>'+ mxInfo[i].mxName +'</p>';
							if(mxInfo[i].fzUserName != ''){
								strHtml += '<p>'+ mxInfo[i].fzUserName +'</p>';
							}else{
								strHtml += '<p>&nbsp;</p>';
							}
							strHtml += '<p>'+ mxInfo[i].mxSDate +'</p>';
							if(mxInfo[i].mxEDate != ''){
								strHtml += '<p>'+ mxInfo[i].mxEDate +'</p>';
							}else{
								strHtml += '<p>&nbsp;</p>';
							}
							strHtml += '</li>';
						}
						strHtml += '</ul>';
						$('#mxDetailCon').html(strHtml);
						$('#mxDetailConUl li:odd').addClass('oddColor');
					}else{
						strHtml += '<ul id="mxDetailConUl">';
						for(var i=0,iLen = mxInfo.length;i<iLen;i++){
							strHtml += '<li class="otherLi hasFlex"><strong>子节点名称 ：</strong><p>'+ mxInfo[i].mxName +'<p></li>';
							strHtml += '<li class="otherLi hasFlex"><strong>流程负责人：</strong><p>'+ mxInfo[i].fzUserName +'<p></li>';
							strHtml += '<li class="otherLi hasFlex"><strong>开始时间：</strong><p>'+ mxInfo[i].mxSDate +'<p></li>';
							if(mxInfo[i].mxEDate != ''){
								strHtml += '<li class="otherLi hasFlex"><strong>结束时间：</strong><p>'+ mxInfo[i].mxEDate +'</p></li>';
							}else{
								strHtml += '<li class="otherLi hasFlex"><strong>结束时间：</strong><p>&nbsp;</p></li>';
							}
							var upFileDetail = mxInfo[i].upFileDetail;
							strHtml += '<li class="otherLi noFlex clearfix"><strong>附件：</strong>';
							if(upFileDetail.length != 0){
								for(var j=0;j<upFileDetail.length;j++){
									strHtml += '<p><i class="layui-icon layui-icon-file"></i>'+ upFileDetail[j].upFileName +' <a href="javascript:void(0)" class="downLoadBtn layui-btn layui-btn-xs" downFilePath="'+ upFileDetail[j].downFilePath +'">下载</a></p>';
								}
							}else{
								strHtml += '<p class="hasNoTxt">暂无附件</p>';
							}
							strHtml += '</li>';
							if(lcNo >=4 && lcNo < 5 ){//增加专利审核审核意见
								strHtml += '<li class="otherLi hasFlex"><strong>审核意见：</strong>';
								if(mxInfo[i].lcPjScore == 0){//审核未通过
									strHtml += '<p class="notPassTxt"><i class="layui-icon layui-icon-face-cry"></i>未通过，退回修改</p>';
								}else{
									var lcScoreVal = 0;
									if(mxInfo[i].lcPjScore == -1){
										strHtml += '<p class="hasNoTxt">暂未审核</p>';
									}else if(mxInfo[i].lcPjScore == 1){
										lcScoreVal = 1;
										strHtml += '<p id="judgeStar">一般</p>';
									}else if(mxInfo[i].lcPjScore == 2){
										lcScoreVal = 2;
										strHtml += '<p id="judgeStar">良</p>';
									}else if(mxInfo[i].lcPjScore == 5){
										lcScoreVal = 5;
										strHtml += '<p id="judgeStar">优秀</p>';
									}
								}
								strHtml += '</li>';
							}else if(lcNo >=5 && lcNo < 6){//客户确认增加客户审核意见
								strHtml += '<li class="otherLi hasFlex"><strong>审核意见：</strong>';
								if(mxInfo[i].cusCheckStatus == '客户确认通过'){
									strHtml += '<p class="cusPassTxt">客户确认通过</p>';
								}else{
									strHtml += '<p class="cusNoPassTxt">客户审核未通过</p>';
								}
								strHtml += '</li>';
							}
							strHtml += '<li class="otherLi noFlex clearfix"><strong>备注：</strong><p>'+ mxInfo[i].mxRemark +'</p></li>';
						}
						strHtml += '</ul>';
						$('#mxDetailCon').html(strHtml);
						rate.render({
						    elem: '#judgeStar'
						    ,value: lcScoreVal
						    ,length:3
						    ,text: true
						    ,readonly: true
						    ,setText: function(value){ //自定义文本的回调
						      var arrs = {
						        '1': '一般'
						        ,'2': '良'
						        ,'3': '优'
						      };
						      this.span.text(arrs[value]);
						    }
						});
						$('.downLoadBtn').on('click',function(){
							var downFilePath = $(this).attr('downFilePath');
							common.downFiles(downFilePath);
						});
					}
					this.addActScrollBar();
				},
				//检测高度动态给容器添加模拟滚动条
				addActScrollBar : function(){
					if($('#mxDetailCon').height() < $('#mxDetailConUl').height()){
						var oScroll = '<div id="scrollParent" class="parentScroll"><div id="scrollSon" class="scrollBar"></div></div>';
						//创建动态模拟滚动条
						$('#mxDetailCon').append(oScroll);
						commonScrollBar.scrollBar('mxDetailCon','mxDetailConUl','scrollParent','scrollSon',25);
					}
				},
				//获取通知书
				renderTzsDetail : function(json){
					var tzsInfo = json.tzsInfo;
					var strHtml = '';
					for(var i=0,iLen = tzsInfo.length;i<iLen;i++){
						strHtml += '<li><p>'+ tzsInfo[i].tzsName +'</p>';
						if(tzsInfo[i].fwrDate != ''){
							strHtml += '<p>'+ tzsInfo[i].fwrDate +'</p>';
						}else{
							strHtml += '<p>&nbsp;</p>';
						}
						if(tzsInfo[i].gfrDate != ''){
							strHtml += '<p>'+ tzsInfo[i].gfrDate +'</p>';
						}else{
							strHtml += '<p>&nbsp;</p>';
						}
						strHtml += '<p><a href="javascript:void(0)" class="downloadBtn" downFilePath="'+ tzsInfo[i].downFilePath +'"><i class="layui-icon layui-icon-download-circle"></i>下载</a></p></li>';
					}
					$('#tzsCon').html(strHtml);
					$('#tzsCon li:odd').addClass('oddColor');
					//下载
					$('.downLoadBtn').on('click',function(){
						var downFilePath = $(this).attr('downFilePath');
						common.downFiles(downFilePath);
					});
				},
				//获取附件详情
				renderFjDetail : function(json){
					var fjInfo = json.fjInfo;
					var strHtml = '';
					for(var i=0,iLen = fjInfo.length;i<iLen;i++){
						strHtml += '<li><p class="oneFjWid ellip">'+ fjInfo[i].fjName +'</p>';
						strHtml += '<p class="twoFjWid">'+ fjInfo[i].fjType +'</p>';
						//strHtml += '<p class="twoFjWid">'+ fjInfo[i].fjVersion +'</p>';
						strHtml += '<p class="twoFjWid">'+ fjInfo[i].fjGs +'</p>';
						if(fjInfo[i].fjDx != ''){
							strHtml += '<p class="twoFjWid">'+ fjInfo[i].fjDx +'</p>';
						}else{
							strHtml += '<p class="twoFjWid">&nbsp;</p>';
						}
						strHtml += '<p class="twoFjWid">'+ fjInfo[i].upUserName +'</p>';
						strHtml += '<p class="threeFjWid">'+ fjInfo[i].upDate +'</p>';
						strHtml += '<p class="fourFjWid"><a href="javascript:void(0)" class="downloadBtn downBtn" downFilePath="'+ fjInfo[i].downFilePath +'"><i class="layui-icon layui-icon-download-circle"></i>下载</a></p></li>';
					}
					$('#fjCon').html(strHtml);
					$('#fjCon li:odd').addClass('oddColor');
					$('.downloadBtn').on('click',function(){
						var downFilePath = $(this).attr('downFilePath');
						common.downFiles(downFilePath);
					});
				},
				//获取费用详情
				renderFyDetail : function(feeInfo){
					var _this = this;
					table.render({
						elem: '#feeListTable',
						height: 'full-220',
						data:feeInfo,
						even : true,
						cols:[[
							{field : 'feeName', title: '费用名称', width:200, fixed: 'left', align:'center'},
							{field : 'applyUserName', title: '操作人', width:100, align:'center'},
							{field : 'feePrice', title: '费用金额', width:100, align:'center',templet : function(d){
								return '<span class="hasSubPrice">'+ d.feePrice +'</span>';
							}},
							{field : 'jnDate', title: '缴费时间', width:120, align:'center'},
							{field : 'jnStatus', title: '缴费状态', width:100, align:'center',templet : function(d){
								if(d.jnStatus == '已交'){
									return '<span class="hasSub">已交</span>';
								}else{
									return '<span class="noSub">未交</span>';
								}
							}},
							{field : 'feeRate', title: '费减', width:100, align:'center',templet:function(d){
								if(d.feeRate != '无费减'){
									return '<span class="hasSub">'+ d.feeRate +'</span>';
								}else{
									return '<span class="noSub">无费减</span>';
								}
							}},
							{field : 'gfDate', title: '官方期限', width:120, align:'center'},
							{field : 'cpyDate', title: '机构期限', width:120, align:'center'},
							{field : 'djStatus', title: '代缴状态', width:100, align:'center'},
							{field : 'backStatus', title: '退换状态', width:100, align:'center',templet : function(d){
								if(d.backStatus != ''){
									if(d.backStatus == '已完成'){
										return '<span class="hasSub">已完成</span>';
									}else{
										return '<span class="noSub">未完成</span>';
									}
								}else{
									return '';
								}
							}},
							{field : 'backFee', title: '退换费用', width:100, align:'center',templet:function(d){
								return '<span class="hasSubPrice">'+ d.backFee +'</span>';
							}},
							{field : 'backDate', title: '退换时间', width:120, align:'center'},
							{field : 'discountsFee', title: '优惠费用', width:100, align:'center'},
							//{field : 'feeZd', title: '费用账单', width:100, align:'center'},
							{field : 'feeRemark', title: '备注', width:210, align:'center'},
							{field : '', title: '操作', width:190, align:'center',fixed:'right',templet:function(d){
								var strHtml_subFee = '',strHtml_zd = '';
								if(d.subFeeFlag){
									strHtml_subFee += '<a href="javascript:void(0)" class="layui-btn layui-btn-xs" feeId="'+ d.feeId +'" subFeeInfo="'+ d.subFeeInfo +'" lay-event="viewSubFeeInfo" feeName="'+ d.feeName +'"><i class="layui-icon layui-icon-search"></i>滞纳金</a>';
								}else{
									strHtml_subFee += '';
								}
								if(d.feeZd != ''){
									strHtml_zd += '<a href="javascript:void(0)" class="layui-btn layui-btn-xs layui-btn-primary" feeId="'+ d.feeId +'" lay-event="viewSubZdInfo" feeName="'+ d.feeName +'"><i class="layui-icon layui-icon-search"></i>查看账单</a>';
								}else{
									strHtml_zd += '';
								}
								return strHtml_subFee + strHtml_zd;
							}}
						]]
					});
				},
				//选择流程分配人员公共弹层
				commonLayerOpen : function(title){
					layer.open({
						title:title,
						type: 2,
					  	area: ['900px', '510px'],
					  	fixed: true, //不固定
					  	maxmin: false,
					  	shadeClose :false,
					  	content: '/Module/zlBasicInfoManager/jsp/selectLcFpStaff.html'
					});	
				}
			};
			table.on('tool(feeListTable)',function(obj){
				if(obj.event == 'viewSubFeeInfo'){//查看滞纳金
					var feeName = $(this).attr('feeName'),feeId = $(this).attr('feeId');
					globalFeeId = feeId;
					layer.open({
						title:'费用[' + feeName + ']的滞纳金记录',
						type: 2,
					  	area: ['900px', '320px'],
					  	fixed: true, //不固定
					  	maxmin: false,
					  	shadeClose :false,
					  	content: '/Module/zlBasicInfoManager/jsp/viewSubFeeInfo.html'
					});
				}else if(obj.event == 'viewSubZdInfo'){
					var feeName = $(this).attr('feeName'),feeId = $(this).attr('feeId');
					globalFeeId = feeId;
					//查看账单附件
					layer.open({
						title:'费用[' + feeName + ']的账单记录',
						type: 2,
					  	area: ['900px', '400px'],
					  	fixed: true, //不固定
					  	maxmin: false,
					  	shadeClose :false,
					  	content: '/Module/zlBasicInfoManager/jsp/viewSubZdInfo.html'
					});
				}
			});
			//专利类型form radio监听事件
			form.on('radio(zlTypeFilter)', function(data){
				if(page.data.upZlFlag){
					var value = data.value;
					$('#zlTypeInp').val(value);
					tmpEwyqIdArray.length = 0;
					if(value == 'fmxx'){
						$('.selZlTaskSp').hide();
					}else{
						$('.selZlTaskSp').show();
					}
					$('#pubZlIdInp').val('');
					parent.$('#lqZlIdInp').val('');
					$('#pubZlIdInpTxt').val('');
					parent.$('#lqZlIdInpText').val('');
					page.getAjNum(value);
					page.getEwYqList(value);
				}
			});
			//案件申请地区form radio监听
			form.on('radio(ajSqAreaFilter)', function(data){
				var value = data.value;
				$('#ajSqAddress').val(value);
			});
			//案件额外要求
			form.on('checkbox(ewyqFilter)',function(data){
				var value = data.value;
				if(page.data.upZlFlag){
					if(data.elem.checked){
						tmpEwyqIdArray.push(value);
					}else{
						for(var i=0;i<tmpEwyqIdArray.length;i++){
							if(value == tmpEwyqIdArray[i]){
								tmpEwyqIdArray.splice(i,1);
							}
						}
					}
				}
			});
			function selectFileUpload(){
				var upLoadFileList = $('#upLoadFileList'),url = '',fileType = 'doc|docx|wps|xls|xlsx|txt|pdf|pptx|ppt|zip|rar|dwg|eml|jpg|png|bmp|gif|jpeg|vsd|vsdx';
				if(addEditZlOpts == 'editZlOpts'){//编辑已增加的专利
					url = '/upload.do?action=uploadFile&ajId=' + zlId + '&fileType=dg';
				}else{//增加专利
					url = '/upload.do?action=uploadFile&ajId=0&fileType=dg';
				}
				globalUpload.uploadFiles(url,5,fileType);
				if(addEditZlOpts == 'editZlOpts' && $('.deleteBtn_edit').length > 0){//表示编辑的时候执行附件删除动作
					$('.deleteBtn_edit').on('click',function(){
						$(this).parent().parent().remove();
						if($('.deleteBtn_edit').length == 0){
							$('#fujianInp').val('');
						}
					});
				}
			}
			$(function(){
				page.init();				
			});
		});
	</script>
</body> 
</html>